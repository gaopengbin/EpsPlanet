import { NzTreeNode } from 'ng-zorro-antd/tree';
import { IdGenerater } from 'epsgis';
import { isArray } from 'lodash';
import { newXbsjFolderNode, newXbsjLayerNode } from '../models/layer-xbsj-func';
export class SceneTreeUtils {
    static SceneTree2NgZorroTree(root) {
        if (!root || !root.children || root.children.length <= 0) {
            return root;
        }
        let rootNode = null;
        if (root.title && root.title !== "未命名") {
            rootNode = new NzTreeNode({
                title: root.title,
                expanded: root.expand === true,
                key: root.guid || root.xbsjGuid || IdGenerater.newGuid(),
                origin: root,
                isLeaf: false,
                parentNode: null
            });
            rootNode.level = -1;
        }
        const _layerNodes = [];
        if (rootNode) {
            rootNode.children.push(...SceneTreeUtils.convertChildren(root.children, rootNode));
            _layerNodes.push(rootNode);
        }
        else {
            _layerNodes.push(...SceneTreeUtils.convertChildren(root.children, rootNode));
        }
        return _layerNodes;
    }
    static convertChildren(children, parentNode) {
        if (!children || children.length <= 0) {
            return [];
        }
        const _layerNodes = [];
        children.forEach(item => {
            let node = null;
            if (item.children) {
                node = new NzTreeNode({
                    level: parentNode.level + 1,
                    title: item.title,
                    isExpanded: item.expand === true,
                    key: item.guid || item.xbsjGuid || IdGenerater.newGuid(),
                    origin: item,
                    isLeaf: false,
                    parentNode: parentNode
                });
                node.parentNode = parentNode;
                node.level = parentNode.level + 1;
                node.isExpanded = item.expand ? true : false;
                if (item.children.length >= 1) {
                    node.children.push(...SceneTreeUtils.convertChildren(item.children, node));
                }
                let checkList = [];
                node.children.forEach((child) => {
                    if (child.children && child.children.length > 0) {
                        checkList.push(child.isChecked);
                    }
                    else {
                        if (child.origin.origin.show) {
                            checkList.push(true);
                        }
                        else {
                            checkList.push(false);
                        }
                    }
                });
                if (SceneTreeUtils.isAllEqual(checkList) && checkList[0] == true) {
                    node.isChecked = true;
                }
                else if (SceneTreeUtils.isAllEqual(checkList) && checkList[0] == false) {
                    node.isChecked = false;
                }
                else if (!SceneTreeUtils.isAllEqual(checkList)) {
                    node.isHalfChecked = true;
                }
                _layerNodes.push(node);
            }
            else {
                let childNode = SceneTreeUtils.convertCzmObject(item.czmObject, parentNode);
                childNode.parentNode = childNode.origin.parentNode;
                childNode.level = childNode.parentNode.level + 1;
                _layerNodes.push(childNode);
            }
        });
        return _layerNodes;
    }
    static isAllEqual(array) {
        if (array.length > 0) {
            return !array.some(function (value, index) {
                return value !== array[0];
            });
        }
        else {
            return true;
        }
    }
    static convertCzmObject(czmObject, parentNode) {
        if (!czmObject) {
            return null;
        }
        return new NzTreeNode({
            title: czmObject.name,
            key: czmObject.guid || czmObject.xbsjGuid || IdGenerater.newGuid(),
            origin: czmObject,
            isLeaf: true,
            checked: czmObject.show,
            parentNode: parentNode
        });
    }
    static GetXbsjCzmObject(node) {
        return node && node.origin && node.origin.origin;
    }
    static loadLayers(layerConfig) {
        if (!layerConfig) {
            return null;
        }
        if (!layerConfig.basemaps && !layerConfig.layers) {
            return null;
        }
        const _layerNodes = [];
        const _layerlist = [
            {
                "title": "basemap",
                "ref": "basemap",
                "children": [],
            },
            {
                "title": "layerlist",
                "ref": "layerlist",
                "children": [],
            },
            {
                "tilte": "pin",
                "ref": "pin",
                "children": []
            }
        ];
        if (typeof layerConfig.basemaps === "object" && isArray(layerConfig.basemaps)) {
            layerConfig.basemaps.forEach((item) => {
                _layerlist[0].children.push(SceneTreeUtils.loadLayerNode(item));
            });
        }
        if (typeof layerConfig.layers === "object" && isArray(layerConfig.layers)) {
            layerConfig.layers.forEach((item) => {
                _layerlist[1].children.push(SceneTreeUtils.loadLayerNode(item));
            });
        }
        return { children: _layerlist };
    }
    static loadLayerNode(item) {
        if (isArray(item.children)) {
            const node = newXbsjFolderNode(item.title);
            if (item.children && item.children.length >= 1) {
                item.children.forEach((child) => {
                    node.children.push(SceneTreeUtils.loadLayerNode(child));
                });
            }
            node.expand = item.expand;
            return node;
        }
        else if (item.url || item.layer) {
            const node = newXbsjLayerNode(item.type, item.title, item.url);
            node.czmObject.xbsjGuid = item.guid;
            node.czmObject.show = item.show ? true : false;
            node.ref = item.ref;
            if (node.czmObject.hasOwnProperty("xbsjImageryProvider")) {
                if (item.srcCoordType) {
                    node.czmObject.xbsjImageryProvider.XbsjImageryProvider.srcCoordType = item.srcCoordType;
                }
                if (item.dstCoordType) {
                    node.czmObject.xbsjImageryProvider.XbsjImageryProvider.dstCoordType = item.dstCoordType;
                }
            }
            else if (node.czmObject.hasOwnProperty("xbsjTerrainProvider")) {
            }
            else if (node.hasOwnProperty("url")) {
            }
            if (item.extendOptions) {
                node.czmObject = Object.assign(node.czmObject, item.extendOptions);
            }
            return node;
        }
        return null;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmVUcmVlLXV0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvZXBzcGxhbmV0L3V0aWxzL3NjZW5lVHJlZS11dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDaEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUNyQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBRWpDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBTWhGLE1BQU0sT0FBTyxjQUFjO0lBS3ZCLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxJQUFTO1FBQ2xDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRTtZQUN0RCxPQUFPLElBQUksQ0FBQztTQUNmO1FBQ0QsSUFBSSxRQUFRLEdBQWUsSUFBSSxDQUFDO1FBQ2hDLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLEtBQUssRUFBRTtZQUNwQyxRQUFRLEdBQUcsSUFBSSxVQUFVLENBQUM7Z0JBQ3RCLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztnQkFDakIsUUFBUSxFQUFFLElBQUksQ0FBQyxNQUFNLEtBQUssSUFBSTtnQkFDOUIsR0FBRyxFQUFFLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLFFBQVEsSUFBSSxXQUFXLENBQUMsT0FBTyxFQUFFO2dCQUN4RCxNQUFNLEVBQUUsSUFBSTtnQkFDWixNQUFNLEVBQUUsS0FBSztnQkFDYixVQUFVLEVBQUUsSUFBSTthQUNuQixDQUFDLENBQUM7WUFDSCxRQUFRLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFBO1NBR3RC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QUFJLENBQUM7U0FDZjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE56VHJlZU5vZGUgfSBmcm9tICduZy16b3Jyby1hbnRkL3RyZWUnO1xuaW1wb3J0IHsgSWRHZW5lcmF0ZXIgfSBmcm9tICdlcHNnaXMnO1xuaW1wb3J0IHsgaXNBcnJheSB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBJTGF5ZXJOb2RlLCBJTGF5ZXJGb2xkZXIgfSBmcm9tICcuLi9tb2RlbHMvbGF5ZXItY29uZmlnJztcbmltcG9ydCB7IG5ld1hic2pGb2xkZXJOb2RlLCBuZXdYYnNqTGF5ZXJOb2RlIH0gZnJvbSAnLi4vbW9kZWxzL2xheWVyLXhic2otZnVuYyc7XG5pbXBvcnQgeyBJWGJzakN6bU9iamVjdCB9IGZyb20gJy4uL21vZGVscy9sYXllci14YnNqJztcblxuLyoqXG4gKiAg5Zy65pmv5qCR5biu5Yqp57G7IGNyZWF0ZSBieSBydWlyXG4gKi9cbmV4cG9ydCBjbGFzcyBTY2VuZVRyZWVVdGlscyB7XG4gICAgLyoqXG4gICAgICog5bCG5Zy65pmv5qCR5pWw5o2u6L2s5Li6bmdab3Jyb+e7k+aehOeahOagkeaVsOaNrlxuICAgICAqIEBwYXJhbSByb290IHRoaXMudmlldy5zY2VuZVRyZWUucm9vdFxuICAgICAqL1xuICAgIHN0YXRpYyBTY2VuZVRyZWUyTmdab3Jyb1RyZWUocm9vdDogYW55KTogQXJyYXk8TnpUcmVlTm9kZT4ge1xuICAgICAgICBpZiAoIXJvb3QgfHwgIXJvb3QuY2hpbGRyZW4gfHwgcm9vdC5jaGlsZHJlbi5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHJvb3ROb2RlOiBOelRyZWVOb2RlID0gbnVsbDtcbiAgICAgICAgaWYgKHJvb3QudGl0bGUgJiYgcm9vdC50aXRsZSAhPT0gXCLmnKrlkb3lkI1cIikge1xuICAgICAgICAgICAgcm9vdE5vZGUgPSBuZXcgTnpUcmVlTm9kZSh7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHJvb3QudGl0bGUsXG4gICAgICAgICAgICAgICAgZXhwYW5kZWQ6IHJvb3QuZXhwYW5kID09PSB0cnVlLFxuICAgICAgICAgICAgICAgIGtleTogcm9vdC5ndWlkIHx8IHJvb3QueGJzakd1aWQgfHwgSWRHZW5lcmF0ZXIubmV3R3VpZCgpLFxuICAgICAgICAgICAgICAgIG9yaWdpbjogcm9vdCxcbiAgICAgICAgICAgICAgICBpc0xlYWY6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHBhcmVudE5vZGU6IG51bGxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcm9vdE5vZGUubGV2ZWwgPSAtMVxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJyb290XCIscm9vdCxyb290Tm9kZSlcbiAgICAgICAgICAgIC8vIHJvb3ROb2RlLmlzRXhwYW5kZWQgPSByb290LmV4cGFuZCA9PT0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBfbGF5ZXJOb2RlczogQXJyYXk8TnpUcmVlTm9kZT4gPSBbXTtcbiAgICAgICAgaWYgKHJvb3ROb2RlKSB7XG4gICAgICAgICAgICByb290Tm9kZS5jaGlsZHJlbi5wdXNoKC4uLlNjZW5lVHJlZVV0aWxzLmNvbnZlcnRDaGlsZHJlbihyb290LmNoaWxkcmVuLCByb290Tm9kZSkpO1xuICAgICAgICAgICAgX2xheWVyTm9kZXMucHVzaChyb290Tm9kZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfbGF5ZXJOb2Rlcy5wdXNoKC4uLlNjZW5lVHJlZVV0aWxzLmNvbnZlcnRDaGlsZHJlbihyb290LmNoaWxkcmVuLCByb290Tm9kZSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIF9sYXllck5vZGVzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gY2hpbGRyZW4gXG4gICAgICogQHBhcmFtIHBhcmVudE5vZGUgXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgY29udmVydENoaWxkcmVuKGNoaWxkcmVuOiBBcnJheTxhbnk+LCBwYXJlbnROb2RlOiBhbnkpOiBBcnJheTxOelRyZWVOb2RlPiB7XG4gICAgICAgIGlmICghY2hpbGRyZW4gfHwgY2hpbGRyZW4ubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBfbGF5ZXJOb2RlczogQXJyYXk8TnpUcmVlTm9kZT4gPSBbXTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IG5vZGU6IE56VHJlZU5vZGUgPSBudWxsO1xuICAgICAgICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4pIHsgLy8gaXRlbS50aXRsZVxuICAgICAgICAgICAgICAgIG5vZGUgPSBuZXcgTnpUcmVlTm9kZSh7XG4gICAgICAgICAgICAgICAgICAgIGxldmVsOiBwYXJlbnROb2RlLmxldmVsICsgMSxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGl0ZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGlzRXhwYW5kZWQ6IGl0ZW0uZXhwYW5kID09PSB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAvLyBpc0NoZWNrZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrZWQ6aXRlbS5pc1NlbGVjdGVkLFxuICAgICAgICAgICAgICAgICAgICBrZXk6IGl0ZW0uZ3VpZCB8fCBpdGVtLnhic2pHdWlkIHx8IElkR2VuZXJhdGVyLm5ld0d1aWQoKSxcbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiBpdGVtLFxuICAgICAgICAgICAgICAgICAgICBpc0xlYWY6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlOiBwYXJlbnROb2RlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgbm9kZS5wYXJlbnROb2RlID0gcGFyZW50Tm9kZTtcbiAgICAgICAgICAgICAgICBub2RlLmxldmVsID0gcGFyZW50Tm9kZS5sZXZlbCArIDE7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgbm9kZS5pc0V4cGFuZGVkPWl0ZW0uZXhwYW5kP3RydWU6ZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4ubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5jaGlsZHJlbi5wdXNoKC4uLlNjZW5lVHJlZVV0aWxzLmNvbnZlcnRDaGlsZHJlbihpdGVtLmNoaWxkcmVuLCBub2RlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIG5vZGUuaXNFeHBhbmRlZCA9IGl0ZW0uZXhwYW5kID09PSB0cnVlO1xuICAgICAgICAgICAgICAgIGxldCBjaGVja0xpc3QgPSBbXVxuICAgICAgICAgICAgICAgIG5vZGUuY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQuY2hpbGRyZW4gJiYgY2hpbGQuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tMaXN0LnB1c2goY2hpbGQuaXNDaGVja2VkKVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm9yaWdpbi5vcmlnaW4uc2hvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrTGlzdC5wdXNoKHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrTGlzdC5wdXNoKGZhbHNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBpZiAoU2NlbmVUcmVlVXRpbHMuaXNBbGxFcXVhbChjaGVja0xpc3QpICYmIGNoZWNrTGlzdFswXSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUuaXNDaGVja2VkID0gdHJ1ZVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoU2NlbmVUcmVlVXRpbHMuaXNBbGxFcXVhbChjaGVja0xpc3QpICYmIGNoZWNrTGlzdFswXSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICBub2RlLmlzQ2hlY2tlZCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghU2NlbmVUcmVlVXRpbHMuaXNBbGxFcXVhbChjaGVja0xpc3QpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUuaXNIYWxmQ2hlY2tlZCA9IHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gbm9kZS5pc0NoZWNrZWQgPSB0cnVlOy8v5Yid5aeL6buY6K6k5Yu+6YCJ54i26IqC54K5XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coaXRlbS50aXRsZSxpdGVtKVxuICAgICAgICAgICAgICAgIF9sYXllck5vZGVzLnB1c2gobm9kZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8v5LmL5YmN5Y+26IqC54K55ou/5LiN5YiwcGFyZW50Tm9kZSzlvLrooYzku47lroPnmoRvcmlnaW7kuK3lj5bliLBwYXJlbnROb2RlLOeUqOS6juWunueOsOiKgueCueeahOWNlemAiVxuICAgICAgICAgICAgICAgIGxldCBjaGlsZE5vZGUgPSBTY2VuZVRyZWVVdGlscy5jb252ZXJ0Q3ptT2JqZWN0KGl0ZW0uY3ptT2JqZWN0LCBwYXJlbnROb2RlKVxuICAgICAgICAgICAgICAgIGNoaWxkTm9kZS5wYXJlbnROb2RlID0gY2hpbGROb2RlLm9yaWdpbi5wYXJlbnROb2RlO1xuICAgICAgICAgICAgICAgIGNoaWxkTm9kZS5sZXZlbCA9IGNoaWxkTm9kZS5wYXJlbnROb2RlLmxldmVsICsgMVxuICAgICAgICAgICAgICAgIF9sYXllck5vZGVzLnB1c2goY2hpbGROb2RlKTtcbiAgICAgICAgICAgICAgICAvLyBfbGF5ZXJOb2Rlcy5wdXNoKFNjZW5lVHJlZVV0aWxzLmNvbnZlcnRDem1PYmplY3QoaXRlbS5jem1PYmplY3QsIHBhcmVudE5vZGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBfbGF5ZXJOb2RlcztcbiAgICB9XG5cbiAgICBzdGF0aWMgaXNBbGxFcXVhbChhcnJheSkge1xuICAgICAgICBpZiAoYXJyYXkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuICFhcnJheS5zb21lKGZ1bmN0aW9uICh2YWx1ZSwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgIT09IGFycmF5WzBdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gY3ptT2JqZWN0IFxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIGNvbnZlcnRDem1PYmplY3QoY3ptT2JqZWN0OiBhbnksIHBhcmVudE5vZGU6IE56VHJlZU5vZGUpOiBOelRyZWVOb2RlIHtcbiAgICAgICAgaWYgKCFjem1PYmplY3QpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgTnpUcmVlTm9kZSh7XG4gICAgICAgICAgICB0aXRsZTogY3ptT2JqZWN0Lm5hbWUsXG4gICAgICAgICAgICBrZXk6IGN6bU9iamVjdC5ndWlkIHx8IGN6bU9iamVjdC54YnNqR3VpZCB8fCBJZEdlbmVyYXRlci5uZXdHdWlkKCksXG4gICAgICAgICAgICBvcmlnaW46IGN6bU9iamVjdCxcbiAgICAgICAgICAgIGlzTGVhZjogdHJ1ZSxcbiAgICAgICAgICAgIC8vIGNoZWNrZWQ6IGN6bU9iamVjdC5pc1NlbGVjdGVkLFxuICAgICAgICAgICAgY2hlY2tlZDogY3ptT2JqZWN0LnNob3csXG4gICAgICAgICAgICBwYXJlbnROb2RlOiBwYXJlbnROb2RlXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBcbiAgICAgKi9cbiAgICBzdGF0aWMgR2V0WGJzakN6bU9iamVjdChub2RlOiBOelRyZWVOb2RlKSB7XG4gICAgICAgIC8vIHJldHVybiBub2RlPy5vcmlnaW4/Lm9yaWdpbjtcbiAgICAgICAgcmV0dXJuIG5vZGUgJiYgbm9kZS5vcmlnaW4gJiYgbm9kZS5vcmlnaW4ub3JpZ2luO1xuICAgIH1cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvKipcbiAgICAgKiDlm77lsYLliqDovb1cbiAgICAgKiBAcGFyYW0gbGF5ZXJDb25maWcgXG4gICAgICovXG4gICAgc3RhdGljIGxvYWRMYXllcnMobGF5ZXJDb25maWc6IGFueSkge1xuICAgICAgICBpZiAoIWxheWVyQ29uZmlnKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxheWVyQ29uZmlnLmJhc2VtYXBzICYmICFsYXllckNvbmZpZy5sYXllcnMpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IF9sYXllck5vZGVzOiBBcnJheTxhbnk+ID0gW107XG4gICAgICAgIC8v5Zu65a6a5bqV5Zu+5ZKM5YW25LuW5Zu+5bGC5YiG57uEXG4gICAgICAgIGNvbnN0IF9sYXllcmxpc3QgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJ0aXRsZVwiOiBcImJhc2VtYXBcIixcbiAgICAgICAgICAgICAgICBcInJlZlwiOiBcImJhc2VtYXBcIixcbiAgICAgICAgICAgICAgICBcImNoaWxkcmVuXCI6IFtdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcInRpdGxlXCI6IFwibGF5ZXJsaXN0XCIsXG4gICAgICAgICAgICAgICAgXCJyZWZcIjogXCJsYXllcmxpc3RcIixcbiAgICAgICAgICAgICAgICBcImNoaWxkcmVuXCI6IFtdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcInRpbHRlXCI6IFwicGluXCIsXG4gICAgICAgICAgICAgICAgXCJyZWZcIjogXCJwaW5cIixcbiAgICAgICAgICAgICAgICBcImNoaWxkcmVuXCI6IFtdXG4gICAgICAgICAgICB9XG4gICAgICAgIF1cblxuICAgICAgICAvL+W6leWbvlxuICAgICAgICBpZiAodHlwZW9mIGxheWVyQ29uZmlnLmJhc2VtYXBzID09PSBcIm9iamVjdFwiICYmIGlzQXJyYXkobGF5ZXJDb25maWcuYmFzZW1hcHMpKSB7XG4gICAgICAgICAgICBsYXllckNvbmZpZy5iYXNlbWFwcy5mb3JFYWNoKChpdGVtOiBJTGF5ZXJOb2RlIHwgSUxheWVyRm9sZGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgX2xheWVybGlzdFswXS5jaGlsZHJlbi5wdXNoKFNjZW5lVHJlZVV0aWxzLmxvYWRMYXllck5vZGUoaXRlbSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy/lm77lsYJcbiAgICAgICAgaWYgKHR5cGVvZiBsYXllckNvbmZpZy5sYXllcnMgPT09IFwib2JqZWN0XCIgJiYgaXNBcnJheShsYXllckNvbmZpZy5sYXllcnMpKSB7XG4gICAgICAgICAgICBsYXllckNvbmZpZy5sYXllcnMuZm9yRWFjaCgoaXRlbTogSUxheWVyTm9kZSB8IElMYXllckZvbGRlcikgPT4ge1xuICAgICAgICAgICAgICAgIF9sYXllcmxpc3RbMV0uY2hpbGRyZW4ucHVzaChTY2VuZVRyZWVVdGlscy5sb2FkTGF5ZXJOb2RlKGl0ZW0pKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGNoaWxkcmVuOiBfbGF5ZXJsaXN0IH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFxuICAgICAqL1xuICAgIHN0YXRpYyBsb2FkTGF5ZXJOb2RlKGl0ZW06IElMYXllck5vZGUgfCBJTGF5ZXJGb2xkZXIpIHtcbiAgICAgICAgaWYgKGlzQXJyYXkoaXRlbS5jaGlsZHJlbikpIHtcbiAgICAgICAgICAgIC8v55uu5b2VXG4gICAgICAgICAgICBjb25zdCBub2RlOiBJTGF5ZXJGb2xkZXIgPSBuZXdYYnNqRm9sZGVyTm9kZShpdGVtLnRpdGxlKTtcbiAgICAgICAgICAgIGlmIChpdGVtLmNoaWxkcmVuICYmIGl0ZW0uY2hpbGRyZW4ubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICAgICAgICBpdGVtLmNoaWxkcmVuLmZvckVhY2goKGNoaWxkOiBJTGF5ZXJOb2RlIHwgSUxheWVyRm9sZGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUuY2hpbGRyZW4ucHVzaChTY2VuZVRyZWVVdGlscy5sb2FkTGF5ZXJOb2RlKGNoaWxkKSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbm9kZS5leHBhbmQ9aXRlbS5leHBhbmQ7XG4gICAgICAgICAgICByZXR1cm4gbm9kZTtcbiAgICAgICAgfSBlbHNlIGlmIChpdGVtLnVybCB8fCBpdGVtLmxheWVyKSB7XG4gICAgICAgICAgICAvL+WbvuWxglxuICAgICAgICAgICAgLy8gdGlhbmRpdHUg6ZyA6KaB5bCGbGF5ZXLovazmjaLkuLp1cmxcblxuICAgICAgICAgICAgY29uc3Qgbm9kZTogSVhic2pDem1PYmplY3QgPSBuZXdYYnNqTGF5ZXJOb2RlKGl0ZW0udHlwZSwgaXRlbS50aXRsZSwgaXRlbS51cmwpO1xuICAgICAgICAgICAgbm9kZS5jem1PYmplY3QueGJzakd1aWQgPSBpdGVtLmd1aWQ7XG4gICAgICAgICAgICBub2RlLmN6bU9iamVjdC5zaG93ID0gaXRlbS5zaG93P3RydWU6ZmFsc2U7XG4gICAgICAgICAgICBub2RlLnJlZiA9IGl0ZW0ucmVmO1xuICAgICAgICAgICAgaWYgKG5vZGUuY3ptT2JqZWN0Lmhhc093blByb3BlcnR5KFwieGJzakltYWdlcnlQcm92aWRlclwiKSkge1xuICAgICAgICAgICAgICAgIC8v5b2x5YOP5Zu+5bGC5aSE55CGXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JjQ29vcmRUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v5Y6f5Z2Q5qCH57O7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUuY3ptT2JqZWN0Lnhic2pJbWFnZXJ5UHJvdmlkZXIuWGJzakltYWdlcnlQcm92aWRlci5zcmNDb29yZFR5cGUgPSBpdGVtLnNyY0Nvb3JkVHlwZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uZHN0Q29vcmRUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v6L2s5o2i55uu5qCH5Z2Q5qCH57O7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUuY3ptT2JqZWN0Lnhic2pJbWFnZXJ5UHJvdmlkZXIuWGJzakltYWdlcnlQcm92aWRlci5kc3RDb29yZFR5cGUgPSBpdGVtLmRzdENvb3JkVHlwZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5vZGUuY3ptT2JqZWN0Lmhhc093blByb3BlcnR5KFwieGJzalRlcnJhaW5Qcm92aWRlclwiKSkge1xuICAgICAgICAgICAgICAgIC8v5Zyw5b2i5Zu+5bGC5aSE55CGXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChub2RlLmhhc093blByb3BlcnR5KFwidXJsXCIpKSB7XG4gICAgICAgICAgICAgICAgLy/nk6bniYflm77lsYLlpITnkIZcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGl0ZW0uZXh0ZW5kT3B0aW9ucykge1xuICAgICAgICAgICAgICAgIG5vZGUuY3ptT2JqZWN0ID0gT2JqZWN0LmFzc2lnbihub2RlLmN6bU9iamVjdCwgaXRlbS5leHRlbmRPcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBub2RlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn0iXX0=