import { Optional, ViewChild, Directive } from '@angular/core';
import { BasePanelComponent } from '../base-panel/base-panel.component';
import { PanelDockMode } from '../../models/base-panel';
import * as i0 from "@angular/core";
const _c0 = ["center_collapse"];
export class BaseDockablePanelComponent extends BasePanelComponent {
    constructor(_render, cdr) {
        super(_render, cdr);
        this._render = _render;
        this.cdr = cdr;
        this.zIndex = 100;
        this._isCollapse = false;
        this.moveTopOnActive = false;
    }
    get mapBounds() {
        var rect = this.commonService.getElementBounds(this.commonService.getComponentRootNode(this.mapManager.comRefMap));
        rect.top = rect.top - this._getMapTop();
        rect.left = rect.left - this._getMapLeft();
        return rect;
    }
    _getMapTop() {
        var ele = this.commonService.getComponentRootNode(this.mapManager.comRefMap);
        const rect = ele.getBoundingClientRect();
        let mapSettingTop = "0";
        if (this.widgetManager.appConfig.map.position && this.widgetManager.appConfig.map.position.top)
            mapSettingTop = this.widgetManager.appConfig.map.position.top;
        let chv = parseFloat(this.commonService.getPxNumber(mapSettingTop).toString());
        const mapTop = rect.top - chv;
        return mapTop;
    }
    _getMapLeft() {
        var ele = this.commonService.getComponentRootNode(this.mapManager.comRefMap);
        const rect = ele.getBoundingClientRect();
        var mapSettingLeft = 0;
        if (this.widgetManager.appConfig.map.position && this.widgetManager.appConfig.map.position.left)
            mapSettingLeft = this.widgetManager.appConfig.map.position.left;
        var chv = parseFloat(this.commonService.getPxNumber(mapSettingLeft).toString());
        const mapLeft = rect.left - chv;
        return mapLeft;
    }
    ngOnInit() {
        super.ngOnInit();
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
    }
    ngOnDestroy() {
        super.ngOnDestroy();
    }
    _setPCPosition() {
        this.widgetConfig.position.zIndex = this.zIndex;
        super._setPCPosition();
    }
    onMove() {
        super.onMove();
    }
    onClose() {
        super.onClose();
    }
    _resizeMapWhenResize() {
        switch (this.dockMode) {
            case PanelDockMode.left:
                this.mapManager.changeMapPosition({ left: this.commonService.getPx(this.currentSize.width) });
                break;
            case PanelDockMode.bottom:
                this.mapManager.changeMapPosition({ bottom: this.commonService.getPx(this.currentSize.height) });
                break;
            case PanelDockMode.right:
                this.mapManager.changeMapPosition({ right: this.commonService.getPx(this.currentSize.width) });
                break;
            default:
                break;
        }
    }
    _resizeMapWhenClose() {
        switch (this.dockMode) {
            case PanelDockMode.left:
                this.mapManager.changeMapPosition({ left: this.commonService.getPx(this.mapManager.originMapPosition.left) });
                break;
            case PanelDockMode.bottom:
                this.mapManager.changeMapPosition({ bottom: this.commonService.getPx(this.mapManager.originMapPosition.bottom) });
                break;
            case PanelDockMode.right:
                this.mapManager.changeMapPosition({ right: this.commonService.getPx(this.mapManager.originMapPosition.right) });
                break;
            default:
                break;
        }
    }
    showPanel() {
        this.__expand(false);
        super.showPanel();
    }
    hidePanel() {
        this.__collapse(false);
        super.hidePanel();
    }
    __collapse(runOnClose) {
        const _eleSvg = this.sspanel_center_collapse.nativeElement.querySelector("svg");
        if (this.dockMode === PanelDockMode.left) {
            const _left = -this.commonService.getElementBounds(this.sspanel.nativeElement).width;
            this._render.setStyle(this.sspanel.nativeElement, "left", _left + "px");
        }
        else if (this.dockMode === PanelDockMode.bottom) {
            const _bottom = -this.commonService.getElementBounds(this.sspanel.nativeElement).height;
            this._render.setStyle(this.sspanel.nativeElement, "bottom", _bottom + "px");
        }
        else if (this.dockMode === PanelDockMode.right) {
            const _right = -this.commonService.getElementBounds(this.sspanel.nativeElement).width;
            this._render.setStyle(this.sspanel.nativeElement, "right", _right + "px");
        }
        this._render.addClass(_eleSvg, "expand");
        this._resizeMapWhenClose();
        this._isCollapse = true;
    }
    __expand(runOnOpen) {
        const _eleSvg = this.sspanel_center_collapse.nativeElement.querySelector("svg");
        if (this.dockMode === PanelDockMode.left) {
            this._render.setStyle(this.sspanel.nativeElement, "left", "0px");
        }
        else if (this.dockMode === PanelDockMode.bottom) {
            this._render.setStyle(this.sspanel.nativeElement, "bottom", "0px");
        }
        else if (this.dockMode === PanelDockMode.right) {
            this._render.setStyle(this.sspanel.nativeElement, "right", "0px");
        }
        this._render.removeClass(_eleSvg, "expand");
        this._resizeMapWhenResize();
        this._isCollapse = false;
    }
    collapsePanel(evt) {
        if (this._isCollapse) {
            this.__expand(false);
        }
        else {
            this.__collapse(false);
        }
    }
}
BaseDockablePanelComponent.ɵfac = function BaseDockablePanelComponent_Factory(t) { return new (t || BaseDockablePanelComponent)(i0.ɵɵdirectiveInject(i0.Renderer2, 8), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef, 8)); };
BaseDockablePanelComponent.ɵdir = i0.ɵɵdefineDirective({ type: BaseDockablePanelComponent, viewQuery: function BaseDockablePanelComponent_Query(rf, ctx) { if (rf & 1) {
        i0.ɵɵviewQuery(_c0, 3);
    } if (rf & 2) {
        let _t;
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.sspanel_center_collapse = _t.first);
    } }, features: [i0.ɵɵInheritDefinitionFeature] });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(BaseDockablePanelComponent, [{
        type: Directive
    }], function () { return [{ type: i0.Renderer2, decorators: [{
                type: Optional
            }] }, { type: i0.ChangeDetectorRef, decorators: [{
                type: Optional
            }] }]; }, { sspanel_center_collapse: [{
            type: ViewChild,
            args: ["center_collapse", { static: true }]
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1kb2NrYWJsZS1wYW5lbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2Vwc2dpcy9jb21wb25lbnRzL2V4LXBhbmVscy9iYXNlLWRvY2thYmxlLXBhbmVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQXlCLFNBQVMsRUFBcUIsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pHLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQzs7O0FBTXhELE1BQU0sT0FBTywwQkFBMkIsU0FBUSxrQkFBa0I7SUFTOUQsWUFBK0IsT0FBa0IsRUFBcUIsR0FBc0I7UUFDeEYsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQztRQURPLFlBQU8sR0FBUCxPQUFPLENBQVc7UUFBcUIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFONUYsV0FBTSxHQUFXLEdBQUcsQ0FBQztRQUlyQixnQkFBVyxHQUFZLEtBQUssQ0FBQztRQUl6QixJQUFJLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQztJQUNqQyxDQUFDO0lBRUQsSUFBSSxTQUFTO1FBRVQsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUVuSCxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3hDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFM0MsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVE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QVcsR0FBRyxLQUFLLENBQUM7SUFDN0IsQ0FBQztJQUlELGFBQWEsQ0FBQyxHQUFHO1FBTWIsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ2xCLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDeEI7YUFBTTtZQUNILElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDMUI7SUFFTCxDQUFDOztvR0F0TFEsMEJBQTBCOytEQUExQiwwQkFBMEI7Ozs7Ozt1RkFBMUIsMEJBQTBCO2NBRHRDLFNBQVM7O3NCQVVPLFFBQVE7O3NCQUErQixRQUFRO3dCQURaLHVCQUF1QjtrQkFBdEUsU0FBUzttQkFBQyxpQkFBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPcHRpb25hbCwgUmVuZGVyZXIyLCBFbGVtZW50UmVmLCBWaWV3Q2hpbGQsIENoYW5nZURldGVjdG9yUmVmLCBEaXJlY3RpdmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJhc2VQYW5lbENvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2UtcGFuZWwvYmFzZS1wYW5lbC5jb21wb25lbnQnO1xuaW1wb3J0IHsgUGFuZWxEb2NrTW9kZSB9IGZyb20gJy4uLy4uL21vZGVscy9iYXNlLXBhbmVsJztcblxuLyoqXG4gKiBcbiAqL1xuQERpcmVjdGl2ZSgpXG5leHBvcnQgY2xhc3MgQmFzZURvY2thYmxlUGFuZWxDb21wb25lbnQgZXh0ZW5kcyBCYXNlUGFuZWxDb21wb25lbnQge1xuXG4gICAgLy8yMDIwMDYwNCBydWlyIOaUueS4uuS6hjEwMO+8jOKAnOi/memHjDk5OTnlr7zoh7Rtb2RhbOmCo+i+ueimgeiuvue9ruWkp+S6jjk5OTnvvIznhLblkI7lr7zoh7RuZ3pvcnJv55qE5o6n5Lu26KKr5oyh5L2P4oCd77yM5YW35L2T5YC86ZyA6KaB5ZCO6Z2i5YaN5paf6YWMXG4gICAgekluZGV4OiBudW1iZXIgPSAxMDA7Ly8gOTk5OTtcbiAgICAvKipcbiAgICAgKiBwYW5lbOaYr+WQpuaUtue8qVxuICAgICAqL1xuICAgIF9pc0NvbGxhcHNlOiBib29sZWFuID0gZmFsc2U7XG4gICAgQFZpZXdDaGlsZChcImNlbnRlcl9jb2xsYXBzZVwiLCB7IHN0YXRpYzogdHJ1ZSB9KSBzc3BhbmVsX2NlbnRlcl9jb2xsYXBzZTogRWxlbWVudFJlZjtcbiAgICBjb25zdHJ1Y3RvcihAT3B0aW9uYWwoKSBwdWJsaWMgX3JlbmRlcjogUmVuZGVyZXIyLCBAT3B0aW9uYWwoKSBwdWJsaWMgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgICAgICBzdXBlcihfcmVuZGVyLCBjZHIpO1xuICAgICAgICB0aGlzLm1vdmVUb3BPbkFjdGl2ZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIGdldCBtYXBCb3VuZHMoKSB7XG5cbiAgICAgICAgdmFyIHJlY3QgPSB0aGlzLmNvbW1vblNlcnZpY2UuZ2V0RWxlbWVudEJvdW5kcyh0aGlzLmNvbW1vblNlcnZpY2UuZ2V0Q29tcG9uZW50Um9vdE5vZGUodGhpcy5tYXBNYW5hZ2VyLmNvbVJlZk1hcCkpO1xuICAgICAgICAvL+iOt+WPlm1hcOWunumZhXRvcOOAgWxlZnTvvJrlh4/ljrvlpJbljIXkuI5tYXB0b3Dorr7nva7nmoTlgLxcbiAgICAgICAgcmVjdC50b3AgPSByZWN0LnRvcCAtIHRoaXMuX2dldE1hcFRvcCgpO1xuICAgICAgICByZWN0LmxlZnQgPSByZWN0LmxlZnQgLSB0aGlzLl9nZXRNYXBMZWZ0KCk7XG4gICAgICAgIC8vcmVjdC53aWR0aD1yZWN0LndpZHRoK3RoaXMuX2dldE1hcExlZnQoKTtcbiAgICAgICAgcmV0dXJuIHJlY3Q7XG4gICAgfVxuICAgIC8vLy8v6I635Y+WbWFw5a6e6ZmFdG9w5YC8XG4gICAgX2dldE1hcFRvcCgpIHtcbiAgICAgICAgdmFyIGVsZSA9IHRoaXMuY29tbW9uU2VydmljZS5nZXRDb21wb25lbnRSb290Tm9kZSh0aGlzLm1hcE1hbmFnZXIuY29tUmVmTWFwKTtcbiAgICAgICAgY29uc3QgcmVjdCA9IGVsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgbGV0IG1hcFNldHRpbmdUb3A6IHN0cmluZyA9IFwiMFwiO1xuICAgICAgICBpZiAodGhpcy53aWRnZXRNYW5hZ2VyLmFwcENvbmZpZy5tYXAucG9zaXRpb24gJiYgdGhpcy53aWRnZXRNYW5hZ2VyLmFwcENvbmZpZy5tYXAucG9zaXRpb24udG9wKVxuICAgICAgICAgICAgbWFwU2V0dGluZ1RvcCA9IHRoaXMud2lkZ2V0TWFuYWdlci5hcHBDb25maWcubWFwLnBvc2l0aW9uLnRvcDtcbiAgICAgICAgbGV0IGNodjogbnVtYmVyID0gcGFyc2VGbG9hdCh0aGlzLmNvbW1vblNlcnZpY2UuZ2V0UHhOdW1iZXIobWFwU2V0dGluZ1RvcCkudG9TdHJpbmcoKSk7XG4gICAgICAgIGNvbnN0IG1hcFRvcCA9IHJlY3QudG9wIC0gY2h2Oy8v6I635Y+W5a6e6ZmFdG9w5YC8XG4gICAgICAgIHJldHVybiBtYXBUb3A7XG4gICAgfVxuICAgIC8vLy8v6I635Y+WbWFw5a6e6ZmFbGVmdOWAvFxuICAgIF9nZXRNYXBMZWZ0KCkge1xuICAgICAgICB2YXIgZWxlID0gdGhpcy5jb21tb25TZXJ2aWNlLmdldENvbXBvbmVudFJvb3ROb2RlKHRoaXMubWFwTWFuYWdlci5jb21SZWZNYXApO1xuICAgICAgICBjb25zdCByZWN0ID0gZWxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICB2YXIgbWFwU2V0dGluZ0xlZnQgPSAwO1xuICAgICAgICBpZiAodGhpcy53aWRnZXRNYW5hZ2VyLmFwcENvbmZpZy5tYXAucG9zaXRpb24gJiYgdGhpcy53aWRnZXRNYW5hZ2VyLmFwcENvbmZpZy5tYXAucG9zaXRpb24ubGVmdClcbiAgICAgICAgICAgIG1hcFNldHRpbmdMZWZ0ID0gdGhpcy53aWRnZXRNYW5hZ2VyLmFwcENvbmZpZy5tYXAucG9zaXRpb24ubGVmdDtcbiAgICAgICAgdmFyIGNodjogbnVtYmVyID0gcGFyc2VGbG9hdCh0aGlzLmNvbW1vblNlcnZpY2UuZ2V0UHhOdW1iZXIobWFwU2V0dGluZ0xlZnQpLnRvU3RyaW5nKCkpO1xuICAgICAgICBjb25zdCBtYXBMZWZ0ID0gcmVjdC5sZWZ0IC0gY2h2Oy8v6I635Y+W5a6e6ZmFbGVmdOWAvFxuICAgICAgICByZXR1cm4gbWFwTGVmdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogXG4gICAgICovXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFxuICAgICAqL1xuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICAgICAgc3VwZXIubmdBZnRlclZpZXdJbml0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFxuICAgICAqL1xuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBzdXBlci5uZ09uRGVzdHJveSgpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgX3NldFBDUG9zaXRpb24oKSB7XG4gICAgICAgIHRoaXMud2lkZ2V0Q29uZmlnLnBvc2l0aW9uLnpJbmRleCA9IHRoaXMuekluZGV4O1xuICAgICAgICBzdXBlci5fc2V0UENQb3NpdGlvbigpO1xuICAgIH1cbiAgICBvbk1vdmUoKSB7XG4gICAgICAgIC8v56e75Yqo5pe2IOWQjOaXtuS/ruato+WFtuS7lue7hOS7tuS9jee9ru+8jOavlOWmguW3sue7j+aJk+W8gOS6hueahHBhbmVsXG4gICAgICAgIHN1cGVyLm9uTW92ZSgpO1xuICAgIH1cbiAgICBvbkNsb3NlKCkge1xuICAgICAgICAvL+WFs+mXreaXtiDov5jljp/lhbbku5bnu4Tku7bkvY3nva5cbiAgICAgICAgc3VwZXIub25DbG9zZSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiDlvZNwYW5lbOWkp+Wwj+aUueWPmOaXtu+8jOaUueWPmG1hcOeahOS9jee9rlxuICAgICAqL1xuICAgIF9yZXNpemVNYXBXaGVuUmVzaXplKCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMuZG9ja01vZGUpIHtcbiAgICAgICAgICAgIGNhc2UgUGFuZWxEb2NrTW9kZS5sZWZ0OlxuICAgICAgICAgICAgICAgIHRoaXMubWFwTWFuYWdlci5jaGFuZ2VNYXBQb3NpdGlvbih7IGxlZnQ6IHRoaXMuY29tbW9uU2VydmljZS5nZXRQeCh0aGlzLmN1cnJlbnRTaXplLndpZHRoKSB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgUGFuZWxEb2NrTW9kZS5ib3R0b206XG4gICAgICAgICAgICAgICAgdGhpcy5tYXBNYW5hZ2VyLmNoYW5nZU1hcFBvc2l0aW9uKHsgYm90dG9tOiB0aGlzLmNvbW1vblNlcnZpY2UuZ2V0UHgodGhpcy5jdXJyZW50U2l6ZS5oZWlnaHQpIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBQYW5lbERvY2tNb2RlLnJpZ2h0OlxuICAgICAgICAgICAgICAgIHRoaXMubWFwTWFuYWdlci5jaGFuZ2VNYXBQb3NpdGlvbih7IHJpZ2h0OiB0aGlzLmNvbW1vblNlcnZpY2UuZ2V0UHgodGhpcy5jdXJyZW50U2l6ZS53aWR0aCkgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICog5b2TcGFuZWzlhbPpl63miJbpmpDol4/ml7bvvIzmlLnlj5htYXDnmoTkvY3nva5cbiAgICAgKi9cbiAgICBfcmVzaXplTWFwV2hlbkNsb3NlKCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMuZG9ja01vZGUpIHtcbiAgICAgICAgICAgIGNhc2UgUGFuZWxEb2NrTW9kZS5sZWZ0OlxuICAgICAgICAgICAgICAgIC8vIHRoaXMubWFwTWFuYWdlci5yZXN0b3JlUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAvL+WPqumcgOaUueWPmGxlZnTvvJ9cbiAgICAgICAgICAgICAgICB0aGlzLm1hcE1hbmFnZXIuY2hhbmdlTWFwUG9zaXRpb24oeyBsZWZ0OiB0aGlzLmNvbW1vblNlcnZpY2UuZ2V0UHgodGhpcy5tYXBNYW5hZ2VyLm9yaWdpbk1hcFBvc2l0aW9uLmxlZnQpIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBQYW5lbERvY2tNb2RlLmJvdHRvbTpcbiAgICAgICAgICAgICAgICAvLyB0aGlzLm1hcE1hbmFnZXIucmVzdG9yZVBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgLy/lj6rpnIDmlLlib3R0b21cbiAgICAgICAgICAgICAgICB0aGlzLm1hcE1hbmFnZXIuY2hhbmdlTWFwUG9zaXRpb24oeyBib3R0b206IHRoaXMuY29tbW9uU2VydmljZS5nZXRQeCh0aGlzLm1hcE1hbmFnZXIub3JpZ2luTWFwUG9zaXRpb24uYm90dG9tKSB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgUGFuZWxEb2NrTW9kZS5yaWdodDpcbiAgICAgICAgICAgICAgICAvLyB0aGlzLm1hcE1hbmFnZXIucmVzdG9yZVBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5tYXBNYW5hZ2VyLmNoYW5nZU1hcFBvc2l0aW9uKHsgcmlnaHQ6IHRoaXMuY29tbW9uU2VydmljZS5nZXRQeCh0aGlzLm1hcE1hbmFnZXIub3JpZ2luTWFwUG9zaXRpb24ucmlnaHQpIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBzaG93UGFuZWwoKSB7XG4gICAgICAgIHRoaXMuX19leHBhbmQoZmFsc2UpO1xuICAgICAgICBzdXBlci5zaG93UGFuZWwoKTtcbiAgICB9XG4gICAgaGlkZVBhbmVsKCkge1xuICAgICAgICB0aGlzLl9fY29sbGFwc2UoZmFsc2UpO1xuICAgICAgICBzdXBlci5oaWRlUGFuZWwoKTtcbiAgICB9XG4gICAgcHJpdmF0ZSBfX2NvbGxhcHNlKHJ1bk9uQ2xvc2U6IGJvb2xlYW4pIHtcbiAgICAgICAgY29uc3QgX2VsZVN2ZyA9IHRoaXMuc3NwYW5lbF9jZW50ZXJfY29sbGFwc2UubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwic3ZnXCIpO1xuICAgICAgICBpZiAodGhpcy5kb2NrTW9kZSA9PT0gUGFuZWxEb2NrTW9kZS5sZWZ0KSB7XG4gICAgICAgICAgICAvL3N1cGVyLl9jb252ZXJ0VG9TdHlsZVZhbCh0aGlzLmN1cnJlbnRTaXplLndpZHRoKVxuICAgICAgICAgICAgY29uc3QgX2xlZnQgPSAtIHRoaXMuY29tbW9uU2VydmljZS5nZXRFbGVtZW50Qm91bmRzKHRoaXMuc3NwYW5lbC5uYXRpdmVFbGVtZW50KS53aWR0aDtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlci5zZXRTdHlsZSh0aGlzLnNzcGFuZWwubmF0aXZlRWxlbWVudCwgXCJsZWZ0XCIsIF9sZWZ0ICsgXCJweFwiKTtcbiAgICAgICAgICAgIC8vdGhpcy5fcmVuZGVyLnNldFN0eWxlKHRoaXMuc3NwYW5lbC5uYXRpdmVFbGVtZW50LCBcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICAgICAgICAgICAgLy8gdGhpcy5fcmVuZGVyLnNldFN0eWxlKHRoaXMuc3NwYW5lbC5uYXRpdmVFbGVtZW50LCBcInotaW5kZXhcIiwgLXRoaXMuekluZGV4KTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmRvY2tNb2RlID09PSBQYW5lbERvY2tNb2RlLmJvdHRvbSkge1xuICAgICAgICAgICAgY29uc3QgX2JvdHRvbSA9IC0gdGhpcy5jb21tb25TZXJ2aWNlLmdldEVsZW1lbnRCb3VuZHModGhpcy5zc3BhbmVsLm5hdGl2ZUVsZW1lbnQpLmhlaWdodDtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlci5zZXRTdHlsZSh0aGlzLnNzcGFuZWwubmF0aXZlRWxlbWVudCwgXCJib3R0b21cIiwgX2JvdHRvbSArIFwicHhcIik7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5kb2NrTW9kZSA9PT0gUGFuZWxEb2NrTW9kZS5yaWdodCkge1xuICAgICAgICAgICAgY29uc3QgX3JpZ2h0ID0gLSB0aGlzLmNvbW1vblNlcnZpY2UuZ2V0RWxlbWVudEJvdW5kcyh0aGlzLnNzcGFuZWwubmF0aXZlRWxlbWVudCkud2lkdGg7XG4gICAgICAgICAgICB0aGlzLl9yZW5kZXIuc2V0U3R5bGUodGhpcy5zc3BhbmVsLm5hdGl2ZUVsZW1lbnQsIFwicmlnaHRcIiwgX3JpZ2h0ICsgXCJweFwiKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yZW5kZXIuYWRkQ2xhc3MoX2VsZVN2ZywgXCJleHBhbmRcIik7XG4gICAgICAgIC8v5Y6f55SfIHRoaXMuc3NwYW5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJzdmdcIikuY2xhc3NMaXN0LmFkZChcImV4cGFuZFwiKVxuICAgICAgICAvLyBpZiAocnVuT25DbG9zZSkge1xuICAgICAgICAvLyAgICAgdGhpcy5vbkNsb3NlKCk7XG4gICAgICAgIC8vIH1cbiAgICAgICAgdGhpcy5fcmVzaXplTWFwV2hlbkNsb3NlKCk7XG4gICAgICAgIHRoaXMuX2lzQ29sbGFwc2UgPSB0cnVlO1xuICAgIH1cbiAgICBwcml2YXRlIF9fZXhwYW5kKHJ1bk9uT3BlbjogYm9vbGVhbikge1xuICAgICAgICBjb25zdCBfZWxlU3ZnID0gdGhpcy5zc3BhbmVsX2NlbnRlcl9jb2xsYXBzZS5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJzdmdcIik7XG4gICAgICAgIGlmICh0aGlzLmRvY2tNb2RlID09PSBQYW5lbERvY2tNb2RlLmxlZnQpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlci5zZXRTdHlsZSh0aGlzLnNzcGFuZWwubmF0aXZlRWxlbWVudCwgXCJsZWZ0XCIsIFwiMHB4XCIpOy8vc3VwZXIuX2NvbnZlcnRUb1N0eWxlVmFsKHRoaXMuY3VycmVudFBvc2l0aW9uLmxlZnQpXG4gICAgICAgICAgICAvL3RoaXMuX3JlbmRlci5zZXRTdHlsZSh0aGlzLnNzcGFuZWwubmF0aXZlRWxlbWVudCwgXCJkaXNwbGF5XCIsIFwiXCIpO1xuICAgICAgICAgICAgLy8gdGhpcy5fcmVuZGVyLnNldFN0eWxlKHRoaXMuc3NwYW5lbC5uYXRpdmVFbGVtZW50LCBcInotaW5kZXhcIiwgdGhpcy56SW5kZXgpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZG9ja01vZGUgPT09IFBhbmVsRG9ja01vZGUuYm90dG9tKSB7XG4gICAgICAgICAgICB0aGlzLl9yZW5kZXIuc2V0U3R5bGUodGhpcy5zc3BhbmVsLm5hdGl2ZUVsZW1lbnQsIFwiYm90dG9tXCIsIFwiMHB4XCIpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZG9ja01vZGUgPT09IFBhbmVsRG9ja01vZGUucmlnaHQpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlci5zZXRTdHlsZSh0aGlzLnNzcGFuZWwubmF0aXZlRWxlbWVudCwgXCJyaWdodFwiLCBcIjBweFwiKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yZW5kZXIucmVtb3ZlQ2xhc3MoX2VsZVN2ZywgXCJleHBhbmRcIik7XG4gICAgICAgIC8v5Y6f55SfIHRoaXMuc3NwYW5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJzdmdcIikuY2xhc3NMaXN0LnJlbW92ZShcImV4cGFuZFwiKVxuICAgICAgICAvLyBpZiAocnVuT25PcGVuKSB7XG4gICAgICAgIC8vICAgICB0aGlzLm9uT3BlbigpO1xuICAgICAgICAvLyB9XG4gICAgICAgIHRoaXMuX3Jlc2l6ZU1hcFdoZW5SZXNpemUoKTtcbiAgICAgICAgdGhpcy5faXNDb2xsYXBzZSA9IGZhbHNlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiDmipjlj6BwYW5lbFxuICAgICAqL1xuICAgIGNvbGxhcHNlUGFuZWwoZXZ0KSB7XG4gICAgICAgIC8v6K6w5b2V5b2T5YmN55qEbGVmdFxuICAgICAgICAvL+makOiXj3BhbmVsXG4gICAgICAgIC8v5pS55Y+Y5Zyw5Zu+5L2N572uXG4gICAgICAgIC8v6L2s5o2i5Zu+5qCHXG4gICAgICAgIC8v5pS55Y+Yc3R5bGXml7bvvIzmmK/lkKbopoHmlLnlj5hwb3NpdGlvbuWAvO+8n1xuICAgICAgICBpZiAodGhpcy5faXNDb2xsYXBzZSkge1xuICAgICAgICAgICAgdGhpcy5fX2V4cGFuZChmYWxzZSk7Ly90cnVlXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9fY29sbGFwc2UoZmFsc2UpOy8vdHJ1ZVxuICAgICAgICB9XG5cbiAgICB9XG59Il19