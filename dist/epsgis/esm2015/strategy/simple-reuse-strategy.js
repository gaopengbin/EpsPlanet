import { AppGlobalConfig } from '../models/app-config';
export class SimpleReuseStrategy {
    constructor(injector) {
        this.injector = injector;
    }
    shouldDetach(route) {
        if (!route.routeConfig || route.routeConfig.loadChildren) {
            return false;
        }
        if (route.data.reuse === false) {
            return false;
        }
        const url = route['_routerState'].url;
        if (!this.appGlobal) {
            this.appGlobal = this.injector.get(AppGlobalConfig);
        }
        if (this.appGlobal.menuConfig
            && this.appGlobal.menuConfig.notReuseRoutes
            && this.appGlobal.menuConfig.notReuseRoutes.length >= 1) {
            return !this.appGlobal.menuConfig.notReuseRoutes.some(n => url.toLocaleLowerCase().indexOf(n.toLocaleLowerCase()) >= 0);
        }
        return true;
    }
    store(route, handle) {
        if (!route.routeConfig || route.routeConfig.loadChildren)
            return;
        const key = SimpleReuseStrategy.getRouteUrl(route);
        if (SimpleReuseStrategy.waitDelete && SimpleReuseStrategy.waitDelete === key) {
            SimpleReuseStrategy.waitDelete = null;
            return;
        }
        SimpleReuseStrategy.snapshots[key] = handle;
    }
    shouldAttach(route) {
        if (!route.routeConfig || route.routeConfig.loadChildren)
            return false;
        return !!SimpleReuseStrategy.snapshots[SimpleReuseStrategy.getRouteUrl(route)];
    }
    retrieve(route) {
        if (!route.routeConfig) {
            return null;
        }
        if (route.routeConfig.loadChildren) {
            Object.keys(SimpleReuseStrategy.snapshots).forEach(key => delete SimpleReuseStrategy.snapshots[key]);
            return null;
        }
        return SimpleReuseStrategy.snapshots[SimpleReuseStrategy.getRouteUrl(route)];
    }
    shouldReuseRoute(future, curr) {
        return future.routeConfig === curr.routeConfig && JSON.stringify(future.params) === JSON.stringify(curr.params);
    }
    static getRouteUrl(route) {
        const key = route['_routerState'].url.replace(/\//g, '_') + '_' + (route.routeConfig.loadChildren || route.routeConfig.component.toString().split('(')[0].split(' ')[1]);
        return key;
    }
    static deleteRouteSnapshot(key) {
        if (SimpleReuseStrategy.snapshots[key]) {
            this.deactivateOutlet(this.snapshots[key]);
            delete SimpleReuseStrategy.snapshots[key];
        }
        else {
            SimpleReuseStrategy.waitDelete = key;
        }
    }
    static deactivateOutlet(handle) {
        const componentRef = handle ? handle['componentRef'] : null;
        if (componentRef) {
            componentRef.destroy();
        }
    }
    static clearRouteSnapshot() {
        for (const key in this.snapshots) {
            if (this.snapshots[key]) {
                this.deactivateOutlet(this.snapshots[key]);
            }
        }
        this.snapshots = {};
        SimpleReuseStrategy.waitDelete = "";
    }
}
SimpleReuseStrategy.snapshots = {};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2ltcGxlLXJldXNlLXN0cmF0ZWd5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvZXBzZ2lzL3N0cmF0ZWd5L3NpbXBsZS1yZXVzZS1zdHJhdGVneS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFNdkQsTUFBTSxPQUFPLG1CQUFtQjtJQU05QixZQUFvQixRQUFrQjtRQUFsQixhQUFRLEdBQVIsUUFBUSxDQUFVO0lBRXRDLENBQUM7SUFRTSxZQUFZLENBQUMsS0FBNkI7UUFFL0MsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxZQUFZLEVBQUU7WUFDeEQsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNELElBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxFQUFFO1lBQzlCLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFDRCxNQUFNLEdBQUcsR0FBVyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQzlDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ25CLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUM7U0FDckQ7UUFDRCxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVTtlQUN4QixJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxjQUFjO2VBQ3hDLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUN2RDtZQUNBLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLGlCQUFpQixFQUFFLENBQUMsT0FBTyxD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UUFDekQsTUFBTSxZQUFZLEdBQXNCLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDL0UsSUFBSSxZQUFZLEVBQUU7WUFDaEIsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFBO1NBQ3ZCO0lBQ0gsQ0FBQztJQUNNLE1BQU0sQ0FBQyxrQkFBa0I7UUFDOUIsS0FBSyxNQUFNLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ2hDLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDdkIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQzthQUU1QztTQUNGO1FBQ0QsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDcEIsbUJBQW1CLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztJQUN0QyxDQUFDOztBQWhJYSw2QkFBUyxHQUEyQyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnRSZWYsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgQWN0aXZhdGVkUm91dGVTbmFwc2hvdCwgRGV0YWNoZWRSb3V0ZUhhbmRsZSwgUm91dGVSZXVzZVN0cmF0ZWd5IH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IEFwcEdsb2JhbENvbmZpZyB9IGZyb20gJy4uL21vZGVscy9hcHAtY29uZmlnJztcbi8vIGV4cG9ydCBjb25zdCBOb3RSZXVzZVJvdXRlc0NvbmZpZ1Rva2VuID0gbmV3IEluamVjdGlvblRva2VuPEFycmF5PHN0cmluZz4+KCdub3RfcmV1c2Vfcm91dGVzX2NvbmZpZycpO1xuLy8gQGR5bmFtaWNcbi8qKlxuICog6Lev55Sx5aSN55So562W55WlXG4gKi9cbmV4cG9ydCBjbGFzcyBTaW1wbGVSZXVzZVN0cmF0ZWd5IGltcGxlbWVudHMgUm91dGVSZXVzZVN0cmF0ZWd5LypJb25pY1JvdXRlU3RyYXRlZ3kgKi8ge1xuXG4gIHB1YmxpYyBzdGF0aWMgc25hcHNob3RzOiB7IFtrZXk6IHN0cmluZ106IERldGFjaGVkUm91dGVIYW5kbGUgfSA9IHt9O1xuICAvLyBwdWJsaWMgc3RhdGljIHNuYXBzaG90czogTWFwPHN0cmluZywgRGV0YWNoZWRSb3V0ZUhhbmRsZT4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgc3RhdGljIHdhaXREZWxldGU6IHN0cmluZztcbiAgcHJpdmF0ZSBhcHBHbG9iYWw6IEFwcEdsb2JhbENvbmZpZztcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHtcblxuICB9XG4gIC8vIGNvbnN0cnVjdG9yKEBJbmplY3QoTm90UmV1c2VSb3V0ZXNDb25maWdUb2tlbikgcHJpdmF0ZSBub3RSZXVzZVJvdXRlczogQXJyYXk8c3RyaW5nPikge1xuXG4gIC8vIH1cbiAgLyoqXG4gICAqIOihqOekuuWvueaJgOaciei3r+eUseWFgeiuuOWkjeeUqO+8jCDlpoLmnpzmnInot6/nlLHkuI3mg7PlpI3nlKjlj6/ku6XlnKjov5nliqDkuIDkupvkuJrliqHpgLvovpHliKTmlq1cbiAgICogQHBhcmFtIHJvdXRlIFxuICAgKi9cbiAgcHVibGljIHNob3VsZERldGFjaChyb3V0ZTogQWN0aXZhdGVkUm91dGVTbmFwc2hvdCk6IGJvb2xlYW4ge1xuICAgIC8vRXJyb3I6IENhbm5vdCByZWF0dGFjaCBBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90IGNyZWF0ZWQgZnJvbSBhIGRpZmZlcmVudCByb3V0ZVxuICAgIGlmICghcm91dGUucm91dGVDb25maWcgfHwgcm91dGUucm91dGVDb25maWcubG9hZENoaWxkcmVuKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChyb3V0ZS5kYXRhLnJldXNlID09PSBmYWxzZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCB1cmw6IHN0cmluZyA9IHJvdXRlWydfcm91dGVyU3RhdGUnXS51cmw7XG4gICAgaWYgKCF0aGlzLmFwcEdsb2JhbCkge1xuICAgICAgdGhpcy5hcHBHbG9iYWwgPSB0aGlzLmluamVjdG9yLmdldChBcHBHbG9iYWxDb25maWcpO1xuICAgIH1cbiAgICBpZiAodGhpcy5hcHBHbG9iYWwubWVudUNvbmZpZ1xuICAgICAgJiYgdGhpcy5hcHBHbG9iYWwubWVudUNvbmZpZy5ub3RSZXVzZVJvdXRlc1xuICAgICAgJiYgdGhpcy5hcHBHbG9iYWwubWVudUNvbmZpZy5ub3RSZXVzZVJvdXRlcy5sZW5ndGggPj0gMVxuICAgICkge1xuICAgICAgcmV0dXJuICF0aGlzLmFwcEdsb2JhbC5tZW51Q29uZmlnLm5vdFJldXNlUm91dGVzLnNvbWUobiA9PiB1cmwudG9Mb2NhbGVMb3dlckNhc2UoKS5pbmRleE9mKG4udG9Mb2NhbGVMb3dlckNhc2UoKSkgPj0gMCk7XG4gICAgfVxuXG4gICAgLy8gaWYgKHRoaXMubm90UmV1c2VSb3V0ZXMgJiYgdGhpcy5ub3RSZXVzZVJvdXRlcy5sZW5ndGggPj0gMSkge1xuICAgIC8vICAgcmV0dXJuICF0aGlzLm5vdFJldXNlUm91dGVzLnNvbWUobiA9PiBuLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT0gdXJsLnRvTG9jYWxlTG93ZXJDYXNlKCkpO1xuICAgIC8vIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlvZPot6/nlLHnprvlvIDml7bkvJrop6blj5HvvIzmjIlwYXRo5L2c5Li6a2V55a2Y5YKo6Lev55Sx5b+r54WnJue7hOS7tuW9k+WJjeWunuS+i+WvueixoVxuICAgKiBAcGFyYW0gcm91dGUgXG4gICAqIEBwYXJhbSBoYW5kbGUgXG4gICAqL1xuICBwdWJsaWMgc3RvcmUocm91dGU6IEFjdGl2YXRlZFJvdXRlU25hcHNob3QsIGhhbmRsZTogRGV0YWNoZWRSb3V0ZUhhbmRsZSk6IHZvaWQge1xuICAgIGlmICghcm91dGUucm91dGVDb25maWcgfHwgcm91dGUucm91dGVDb25maWcubG9hZENoaWxkcmVuKSByZXR1cm47XG4gICAgY29uc3Qga2V5ID0gU2ltcGxlUmV1c2VTdHJhdGVneS5nZXRSb3V0ZVVybChyb3V0ZSk7XG4gICAgaWYgKFNpbXBsZVJldXNlU3RyYXRlZ3kud2FpdERlbGV0ZSAmJiBTaW1wbGVSZXVzZVN0cmF0ZWd5LndhaXREZWxldGUgPT09IGtleSkge1xuICAgICAgLy8g5aaC5p6c5b6F5Yig6Zmk5piv5b2T5YmN6Lev55Sx5YiZ5LiN5a2Y5YKo5b+r54WnXG4gICAgICBTaW1wbGVSZXVzZVN0cmF0ZWd5LndhaXREZWxldGUgPSBudWxsO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBTaW1wbGVSZXVzZVN0cmF0ZWd5LnNuYXBzaG90c1trZXldID0gaGFuZGxlO1xuICB9XG5cbiAgLyoqXG4gICAqIOWmguaenCBwYXRoIOWcqOe8k+WtmOS4reacieeahOmDveiupOS4uuWFgeiuuOi/mOWOn+i3r+eUsVxuICAgKiBAcGFyYW0gcm91dGUgXG4gICAqL1xuICBwdWJsaWMgc2hvdWxkQXR0YWNoKHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90KTogYm9vbGVhbiB7XG4gICAgaWYgKCFyb3V0ZS5yb3V0ZUNvbmZpZyB8fCByb3V0ZS5yb3V0ZUNvbmZpZy5sb2FkQ2hpbGRyZW4pIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gISFTaW1wbGVSZXVzZVN0cmF0ZWd5LnNuYXBzaG90c1tTaW1wbGVSZXVzZVN0cmF0ZWd5LmdldFJvdXRlVXJsKHJvdXRlKV07XG4gIH1cblxuICAvKipcbiAgICog5LuO57yT5a2Y5Lit6I635Y+W5b+r54Wn77yM6Iul5peg5YiZ6L+U5ZuebnVsXG4gICAqIEBwYXJhbSByb3V0ZSBcbiAgICovXG4gIHB1YmxpYyByZXRyaWV2ZShyb3V0ZTogQWN0aXZhdGVkUm91dGVTbmFwc2hvdCk6IERldGFjaGVkUm91dGVIYW5kbGUge1xuICAgIGlmICghcm91dGUucm91dGVDb25maWcpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvLyBpZiAoIXJvdXRlLnJvdXRlQ29uZmlnIHx8IHJvdXRlLnJvdXRlQ29uZmlnLmxvYWRDaGlsZHJlbikge1xuICAgIC8vICAgcmV0dXJuIG51bGxcbiAgICAvLyB9XG4gICAgLy8gU2ltcGxlUmV1c2VTdHJhdGVneS53YWl0RGVsZXRlID0gU2ltcGxlUmV1c2VTdHJhdGVneS5nZXRSb3V0ZVVybChyb3V0ZSk7XG5cbiAgICBpZiAocm91dGUucm91dGVDb25maWcubG9hZENoaWxkcmVuKSB7XG4gICAgICBPYmplY3Qua2V5cyhTaW1wbGVSZXVzZVN0cmF0ZWd5LnNuYXBzaG90cykuZm9yRWFjaChrZXkgPT4gZGVsZXRlIFNpbXBsZVJldXNlU3RyYXRlZ3kuc25hcHNob3RzW2tleV0pO1xuICAgICAgcmV0dXJuIG51bGwgYXMgYW55O1xuICAgIH1cbiAgICByZXR1cm4gU2ltcGxlUmV1c2VTdHJhdGVneS5zbmFwc2hvdHNbU2ltcGxlUmV1c2VTdHJhdGVneS5nZXRSb3V0ZVVybChyb3V0ZSldO1xuICB9XG5cbiAgLyoqXG4gICAqIOi/m+WFpei3r+eUseinpuWPke+8jOWIpOaWreaYr+WQpuWQjOS4gOi3r+eUsVxuICAgKiBAcGFyYW0gZnV0dXJlIFxuICAgKiBAcGFyYW0gY3VyciBcbiAgICovXG4gIHB1YmxpYyBzaG91bGRSZXVzZVJvdXRlKGZ1dHVyZTogQWN0aXZhdGVkUm91dGVTbmFwc2hvdCwgY3VycjogQWN0aXZhdGVkUm91dGVTbmFwc2hvdCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBmdXR1cmUucm91dGVDb25maWcgPT09IGN1cnIucm91dGVDb25maWcgJiYgSlNPTi5zdHJpbmdpZnkoZnV0dXJlLnBhcmFtcykgPT09IEpTT04uc3RyaW5naWZ5KGN1cnIucGFyYW1zKTtcbiAgfVxuICAvKipcbiAgICog6I635Y+WdXJsXG4gICAqIEBwYXJhbSByb3V0ZSBcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZ2V0Um91dGVVcmwocm91dGU6IEFjdGl2YXRlZFJvdXRlU25hcHNob3QpIHtcbiAgICAvLyByZXR1cm4gcm91dGVbJ19yb3V0ZXJTdGF0ZSddLnVybC5yZXBsYWNlKC9cXC8vZywgJ18nKTtcbiAgICBjb25zdCBrZXkgPSByb3V0ZVsnX3JvdXRlclN0YXRlJ10udXJsLnJlcGxhY2UoL1xcLy9nLCAnXycpICsgJ18nICsgKHJvdXRlLnJvdXRlQ29uZmlnLmxvYWRDaGlsZHJlbiB8fCByb3V0ZS5yb3V0ZUNvbmZpZy5jb21wb25lbnQudG9TdHJpbmcoKS5zcGxpdCgnKCcpWzBdLnNwbGl0KCcgJylbMV0pO1xuICAgIHJldHVybiBrZXk7XG4gIH1cbiAgLyoqXG4gICAqIOWmguaenOaciei3r+eUsee8k+WtmO+8jOWImeWIoOmZpFxuICAgKiBAcGFyYW0gdXJsIFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBkZWxldGVSb3V0ZVNuYXBzaG90KGtleTogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKFNpbXBsZVJldXNlU3RyYXRlZ3kuc25hcHNob3RzW2tleV0pIHtcbiAgICAgIHRoaXMuZGVhY3RpdmF0ZU91dGxldCh0aGlzLnNuYXBzaG90c1trZXldKVxuICAgICAgZGVsZXRlIFNpbXBsZVJldXNlU3RyYXRlZ3kuc25hcHNob3RzW2tleV07XG4gICAgfSBlbHNlIHtcbiAgICAgIFNpbXBsZVJldXNlU3RyYXRlZ3kud2FpdERlbGV0ZSA9IGtleTtcbiAgICB9XG4gIH1cbiAgcHJpdmF0ZSBzdGF0aWMgZGVhY3RpdmF0ZU91dGxldChoYW5kbGU6IERldGFjaGVkUm91dGVIYW5kbGUpOiB2b2lkIHtcbiAgICBjb25zdCBjb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxhbnk+ID0gaGFuZGxlID8gaGFuZGxlWydjb21wb25lbnRSZWYnXSA6IG51bGw7XG4gICAgaWYgKGNvbXBvbmVudFJlZikge1xuICAgICAgY29tcG9uZW50UmVmLmRlc3Ryb3koKVxuICAgIH1cbiAgfVxuICBwdWJsaWMgc3RhdGljIGNsZWFyUm91dGVTbmFwc2hvdCgpIHtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLnNuYXBzaG90cykge1xuICAgICAgaWYgKHRoaXMuc25hcHNob3RzW2tleV0pIHtcbiAgICAgICAgdGhpcy5kZWFjdGl2YXRlT3V0bGV0KHRoaXMuc25hcHNob3RzW2tleV0pO1xuICAgICAgICAvLyBkZWxldGUgdGhpcy5zbmFwc2hvdHNba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5zbmFwc2hvdHMgPSB7fTtcbiAgICBTaW1wbGVSZXVzZVN0cmF0ZWd5LndhaXREZWxldGUgPSBcIlwiO1xuICB9XG59Il19