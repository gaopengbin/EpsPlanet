import { Injectable } from '@angular/core';
import { WidgetPosition } from '../models/base-widget';
import { isPlatform } from '../utils/platform';
import * as i0 from "@angular/core";
import * as i1 from "./utils.service";
import * as i2 from "./platform.service";
export class CommonService {
    constructor(utils, platform) {
        this.utils = utils;
        this.platform = platform;
    }
    createPromiseDefer() {
        let resolve, reject;
        const promise = new Promise(function () {
            resolve = arguments[0];
            reject = arguments[1];
        });
        return {
            resolve: resolve,
            reject: reject,
            promise: () => promise
        };
    }
    getComponentRootNode(componentRef) {
        if (!componentRef) {
            console.log('componentRef undefined');
            return null;
        }
        return componentRef.hostView.rootNodes[0];
    }
    getElementBounds(ele) {
        if (!ele)
            return null;
        const rect = ele.getBoundingClientRect();
        const top = document.documentElement.clientTop;
        const left = document.documentElement.clientLeft;
        return {
            top: rect.top - top,
            left: rect.left - left,
            bottom: rect.bottom - top,
            right: rect.right - left,
            width: rect.width,
            height: rect.height
        };
    }
    getPx(px) {
        if (!px)
            return "0px";
        if (typeof px === "string" && px.indexOf("px") >= 0) {
            return px;
        }
        if (px.toString().indexOf("%") >= 0 || px === "auto")
            return px;
        if (typeof px === "number")
            return px + "px";
        let _temp = parseFloat(px);
        if (isNaN(_temp)) {
            return "0px";
        }
        return _temp + "px";
    }
    getPxNumber(px) {
        if (!px)
            return 0;
        if (typeof px === "string" && px.indexOf("px") >= 0) {
            return parseInt(px, 10);
        }
        if (px.toString().indexOf("%") >= 0 || px === "auto")
            return px;
        if (typeof px === "number")
            return px;
        let _temp = parseFloat(px.toString());
        if (isNaN(_temp)) {
            return 0;
        }
        return _temp;
    }
    getPosition(positionConfig) {
        let _position = new WidgetPosition();
        if (positionConfig.top || positionConfig.top == 0) {
            _position.top = this.getPx(positionConfig.top);
        }
        if (positionConfig.left || positionConfig.left == 0) {
            _position.left = this.getPx(positionConfig.left);
        }
        if (positionConfig.right || positionConfig.right == 0) {
            _position.right = this.getPx(positionConfig.right);
        }
        if (positionConfig.bottom || positionConfig.bottom == 0) {
            _position.bottom = this.getPx(positionConfig.bottom);
        }
        if (positionConfig.width || positionConfig.width == 0) {
            _position.width = this.getPx(positionConfig.width);
        }
        else {
            _position.width = "100%";
        }
        if (positionConfig.height || positionConfig.height == 0) {
            _position.height = this.getPx(positionConfig.height);
        }
        else {
            _position.height = "100%";
        }
        if (positionConfig.zIndex || positionConfig.zIndex == 0) {
            _position.zIndex = positionConfig.zIndex;
        }
        return _position;
    }
    setWidgetPosition(compRef, widgetPosition) {
        let ele = this.getComponentRootNode(compRef);
        let css = this.utils.getPositionStyle(widgetPosition);
        ele.style.position = "absolute";
        if (css.top || css.top == 0) {
            ele.style.top = css.top;
        }
        if (css.right || css.right == 0) {
            ele.style.right = css.right;
        }
        if (css.bottom || css.bottom == 0) {
            ele.style.bottom = css.bottom;
        }
        if (css.left || css.left == 0) {
            ele.style.left = css.left;
        }
        if (css.width || css.width == 0) {
            ele.style.width = css.width;
        }
        if (css.height || css.height == 0) {
            ele.style.height = css.height;
        }
        if (css.zIndex || css.zIndex == 0) {
            ele.style.zIndex = css.zIndex;
        }
    }
    is(platformName) {
        return isPlatform(this.win, platformName);
    }
    getPlatformName() {
        if (this.isAndroid())
            return 'android';
        if (this.isIos())
            return 'ios';
        if (!this.isMobile())
            return 'browser';
        return 'unknown';
    }
    isMobileNotTablet() {
        return this.isMobile()
            && this.platform.is("ipad") == false
            && this.platform.is("phablet") == false
            && this.platform.is("tablet") == false;
    }
    isMobile() {
        return this.platform.is("mobile") || this.platform.is("mobileweb");
    }
    isMobileRealMachine() {
        return this.platform.is('mobile') && !this.platform.is('mobileweb');
    }
    isAndroid() {
        return this.isMobileRealMachine() && this.platform.is('android');
    }
    isIos() {
        return this.isMobileRealMachine() && (this.platform.is('ios') || this.platform.is('ipad') || this.platform.is('iphone'));
    }
}
CommonService.ɵfac = function CommonService_Factory(t) { return new (t || CommonService)(i0.ɵɵinject(i1.UtilsService), i0.ɵɵinject(i2.PlatformService)); };
CommonService.ɵprov = i0.ɵɵdefineInjectable({ token: CommonService, factory: CommonService.ɵfac, providedIn: 'root' });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(CommonService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: i1.UtilsService }, { type: i2.PlatformService }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9lcHNnaXMvc2VydmljZXMvY29tbW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBaUMsTUFBTSxlQUFlLENBQUM7QUFDMUUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxVQUFVLEVBQWEsTUFBTSxtQkFBbUIsQ0FBQTs7OztBQVF6RCxNQUFNLE9BQU8sYUFBYTtJQUV4QixZQUNVLEtBQW1CLEVBQ25CLFFBQXlCO1FBRHpCLFVBQUssR0FBTCxLQUFLLENBQWM7UUFDbkIsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7SUFHbkMsQ0FBQztJQUlELGtCQUFrQjtRQUNoQixJQUFJLE9BQU8sRUFBRSxNQUFNLENBQUM7UUFDcEIsTUFBTSxPQUFPLEdBQUcsSUFBSSxPQUFPLENBQU07WUFDL0IsT0FBTyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2QixNQUFNLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTztZQUNMLE9BQU8sRUFBRSxPQUFPO1lBQ2hCLE1BQU0sRUFBRSxNQUFNO1lBQ2QsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLE9BQU87U0FDdkIsQ0FBQztJQUNKLENBQUM7SUFNRCxvQkFBb0IsQ0FBQyxZQUErQjtRQUNsRCxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ2pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUMsQ0FBQztZQUN0QyxPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsT0FBUSxZQUFZLENBQUMsUUFBaUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFnQixDQUFDO0lBQ3JGLENBQUM7SUFLRCxnQkFBZ0IsQ0FBQyxHQUFnQjtRQUMvQixJQUFJ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T0FBTyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDM0gsQ0FBQzs7MEVBeE5VLGFBQWE7cURBQWIsYUFBYSxXQUFiLGFBQWEsbUJBRlosTUFBTTt1RkFFUCxhQUFhO2NBSHpCLFVBQVU7ZUFBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFV0aWxzU2VydmljZSB9IGZyb20gJy4vdXRpbHMuc2VydmljZSc7XG5pbXBvcnQgeyBJbmplY3RhYmxlLCBDb21wb25lbnRSZWYsIEVtYmVkZGVkVmlld1JlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgV2lkZ2V0UG9zaXRpb24gfSBmcm9tICcuLi9tb2RlbHMvYmFzZS13aWRnZXQnO1xuaW1wb3J0IHsgaXNQbGF0Zm9ybSwgUGxhdGZvcm1zIH0gZnJvbSAnLi4vdXRpbHMvcGxhdGZvcm0nXG5pbXBvcnQgeyBQbGF0Zm9ybVNlcnZpY2UgfSBmcm9tIFwiLi9wbGF0Zm9ybS5zZXJ2aWNlXCI7XG4vKipcbiAqIGNyZWF0ZSBieSBydWlyIDE5MTAxNSAg6YCa55So5Yqf6IO95Ye95pWwXG4gKi9cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIENvbW1vblNlcnZpY2Uge1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgdXRpbHM6IFV0aWxzU2VydmljZSxcbiAgICBwcml2YXRlIHBsYXRmb3JtOiBQbGF0Zm9ybVNlcnZpY2VcbiAgKSB7XG5cbiAgfVxuICAvKipcbiAgICogXG4gICAqL1xuICBjcmVhdGVQcm9taXNlRGVmZXIoKSB7XG4gICAgbGV0IHJlc29sdmUsIHJlamVjdDtcbiAgICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2U8YW55PihmdW5jdGlvbiAoKSB7XG4gICAgICByZXNvbHZlID0gYXJndW1lbnRzWzBdO1xuICAgICAgcmVqZWN0ID0gYXJndW1lbnRzWzFdO1xuICAgIH0pO1xuICAgIHJldHVybiB7XG4gICAgICByZXNvbHZlOiByZXNvbHZlLFxuICAgICAgcmVqZWN0OiByZWplY3QsXG4gICAgICBwcm9taXNlOiAoKSA9PiBwcm9taXNlXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnu4Tku7bmoLnnuqflhYPntKBcbiAgICogQHBhcmFtIGNvbXBvbmVudFJlZiBcbiAgICovXG4gIGdldENvbXBvbmVudFJvb3ROb2RlKGNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPGFueT4pOiBIVE1MRWxlbWVudCB7XG4gICAgaWYgKCFjb21wb25lbnRSZWYpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdjb21wb25lbnRSZWYgdW5kZWZpbmVkJyk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIChjb21wb25lbnRSZWYuaG9zdFZpZXcgYXMgRW1iZWRkZWRWaWV3UmVmPGFueT4pLnJvb3ROb2Rlc1swXSBhcyBIVE1MRWxlbWVudDtcbiAgfVxuICAvKipcbiAgICog6I635Y+W5YWD57Sg6IyD5Zu06L6555WMXG4gICAqIEBwYXJhbSBlbGUgXG4gICAqL1xuICBnZXRFbGVtZW50Qm91bmRzKGVsZTogSFRNTEVsZW1lbnQpIHtcbiAgICBpZiAoIWVsZSkgcmV0dXJuIG51bGw7XG4gICAgY29uc3QgcmVjdCA9IGVsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGNvbnN0IHRvcCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRUb3A7XG5cbiAgICBjb25zdCBsZWZ0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudExlZnQ7XG5cbiAgICByZXR1cm4ge1xuXG4gICAgICB0b3A6IHJlY3QudG9wIC0gdG9wLFxuICAgICAgbGVmdDogcmVjdC5sZWZ0IC0gbGVmdCxcbiAgICAgIGJvdHRvbTogcmVjdC5ib3R0b20gLSB0b3AsXG4gICAgICByaWdodDogcmVjdC5yaWdodCAtIGxlZnQsXG4gICAgICB3aWR0aDogcmVjdC53aWR0aCxcbiAgICAgIGhlaWdodDogcmVjdC5oZWlnaHRcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogXG4gICAqIEBwYXJhbSBweCBcbiAgICovXG4gIGdldFB4KHB4KSB7XG4gICAgLy8gbGV0IHh4eHh4ID0gXy5pc051bWJlcihcIjMwMFwiKTsvL+WxheeEtuaYr2ZhbHNlXG4gICAgaWYgKCFweCkgcmV0dXJuIFwiMHB4XCI7XG4gICAgaWYgKHR5cGVvZiBweCA9PT0gXCJzdHJpbmdcIiAmJiBweC5pbmRleE9mKFwicHhcIikgPj0gMCkge1xuICAgICAgcmV0dXJuIHB4O1xuICAgIH1cbiAgICBpZiAocHgudG9TdHJpbmcoKS5pbmRleE9mKFwiJVwiKSA+PSAwIHx8IHB4ID09PSBcImF1dG9cIikgcmV0dXJuIHB4O1xuICAgIGlmICh0eXBlb2YgcHggPT09IFwibnVtYmVyXCIpXG4gICAgICByZXR1cm4gcHggKyBcInB4XCI7XG4gICAgbGV0IF90ZW1wID0gcGFyc2VGbG9hdChweCk7XG4gICAgaWYgKGlzTmFOKF90ZW1wKSkge1xuICAgICAgcmV0dXJuIFwiMHB4XCI7XG4gICAgfVxuICAgIHJldHVybiBfdGVtcCArIFwicHhcIjtcblxuICB9XG4gIC8qKlxuICAgKiBcbiAgICogQHBhcmFtIHB4IFxuICAgKi9cbiAgZ2V0UHhOdW1iZXIocHg6IG51bWJlciB8IHN0cmluZyk6IG51bWJlciB8IHN0cmluZyB7XG4gICAgaWYgKCFweCkgcmV0dXJuIDA7XG5cbiAgICBpZiAodHlwZW9mIHB4ID09PSBcInN0cmluZ1wiICYmIHB4LmluZGV4T2YoXCJweFwiKSA+PSAwKSB7XG4gICAgICByZXR1cm4gcGFyc2VJbnQocHgsIDEwKTtcbiAgICB9XG4gICAgaWYgKHB4LnRvU3RyaW5nKCkuaW5kZXhPZihcIiVcIikgPj0gMCB8fCBweCA9PT0gXCJhdXRvXCIpIHJldHVybiBweDtcblxuICAgIGlmICh0eXBlb2YgcHggPT09IFwibnVtYmVyXCIpXG4gICAgICByZXR1cm4gcHg7XG5cbiAgICBsZXQgX3RlbXAgPSBwYXJzZUZsb2F0KHB4LnRvU3RyaW5nKCkpO1xuICAgIGlmIChpc05hTihfdGVtcCkpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICByZXR1cm4gX3RlbXA7XG4gIH1cbiAgLyoqXG4gICAqIFxuICAgKiBAcGFyYW0gcG9zaXRpb25Db25maWcgXG4gICAqL1xuICBnZXRQb3NpdGlvbihwb3NpdGlvbkNvbmZpZzogYW55KTogV2lkZ2V0UG9zaXRpb24ge1xuICAgIGxldCBfcG9zaXRpb246IFdpZGdldFBvc2l0aW9uID0gbmV3IFdpZGdldFBvc2l0aW9uKCk7XG4gICAgaWYgKHBvc2l0aW9uQ29uZmlnLnRvcCB8fCBwb3NpdGlvbkNvbmZpZy50b3AgPT0gMCkge1xuICAgICAgX3Bvc2l0aW9uLnRvcCA9IHRoaXMuZ2V0UHgocG9zaXRpb25Db25maWcudG9wKTtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uQ29uZmlnLmxlZnQgfHwgcG9zaXRpb25Db25maWcubGVmdCA9PSAwKSB7XG4gICAgICBfcG9zaXRpb24ubGVmdCA9IHRoaXMuZ2V0UHgocG9zaXRpb25Db25maWcubGVmdCk7XG4gICAgfVxuICAgIGlmIChwb3NpdGlvbkNvbmZpZy5yaWdodCB8fCBwb3NpdGlvbkNvbmZpZy5yaWdodCA9PSAwKSB7XG4gICAgICBfcG9zaXRpb24ucmlnaHQgPSB0aGlzLmdldFB4KHBvc2l0aW9uQ29uZmlnLnJpZ2h0KTtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uQ29uZmlnLmJvdHRvbSB8fCBwb3NpdGlvbkNvbmZpZy5ib3R0b20gPT0gMCkge1xuICAgICAgX3Bvc2l0aW9uLmJvdHRvbSA9IHRoaXMuZ2V0UHgocG9zaXRpb25Db25maWcuYm90dG9tKTtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uQ29uZmlnLndpZHRoIHx8IHBvc2l0aW9uQ29uZmlnLndpZHRoID09IDApIHtcbiAgICAgIF9wb3NpdGlvbi53aWR0aCA9IHRoaXMuZ2V0UHgocG9zaXRpb25Db25maWcud2lkdGgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBfcG9zaXRpb24ud2lkdGggPSBcIjEwMCVcIjtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uQ29uZmlnLmhlaWdodCB8fCBwb3NpdGlvbkNvbmZpZy5oZWlnaHQgPT0gMCkge1xuICAgICAgX3Bvc2l0aW9uLmhlaWdodCA9IHRoaXMuZ2V0UHgocG9zaXRpb25Db25maWcuaGVpZ2h0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgX3Bvc2l0aW9uLmhlaWdodCA9IFwiMTAwJVwiO1xuICAgIH1cbiAgICBpZiAocG9zaXRpb25Db25maWcuekluZGV4IHx8IHBvc2l0aW9uQ29uZmlnLnpJbmRleCA9PSAwKSB7XG4gICAgICBfcG9zaXRpb24uekluZGV4ID0gcG9zaXRpb25Db25maWcuekluZGV4O1xuICAgIH1cbiAgICByZXR1cm4gX3Bvc2l0aW9uO1xuICB9XG4gIC8qKlxuICAgKiDorr7nva7nu4Tku7bkvY3nva5cbiAgICogQHBhcmFtIGNvbXBSZWYgXG4gICAqIEBwYXJhbSB3aWRnZXRQb3NpdGlvbiBcbiAgICovXG4gIHNldFdpZGdldFBvc2l0aW9uKGNvbXBSZWY6IENvbXBvbmVudFJlZjxhbnk+LCB3aWRnZXRQb3NpdGlvbjogYW55KSB7XG4gICAgbGV0IGVsZTogSFRNTEVsZW1lbnQgPSB0aGlzLmdldENvbXBvbmVudFJvb3ROb2RlKGNvbXBSZWYpO1xuICAgIGxldCBjc3MgPSB0aGlzLnV0aWxzLmdldFBvc2l0aW9uU3R5bGUod2lkZ2V0UG9zaXRpb24pO1xuICAgIGVsZS5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICBpZiAoY3NzLnRvcCB8fCBjc3MudG9wID09IDApIHtcbiAgICAgIGVsZS5zdHlsZS50b3AgPSBjc3MudG9wO1xuICAgIH1cbiAgICBpZiAoY3NzLnJpZ2h0IHx8IGNzcy5yaWdodCA9PSAwKSB7XG4gICAgICBlbGUuc3R5bGUucmlnaHQgPSBjc3MucmlnaHQ7XG4gICAgfVxuICAgIGlmIChjc3MuYm90dG9tIHx8IGNzcy5ib3R0b20gPT0gMCkge1xuICAgICAgZWxlLnN0eWxlLmJvdHRvbSA9IGNzcy5ib3R0b207XG4gICAgfVxuICAgIGlmIChjc3MubGVmdCB8fCBjc3MubGVmdCA9PSAwKSB7XG4gICAgICBlbGUuc3R5bGUubGVmdCA9IGNzcy5sZWZ0O1xuICAgIH1cbiAgICBpZiAoY3NzLndpZHRoIHx8IGNzcy53aWR0aCA9PSAwKSB7XG4gICAgICBlbGUuc3R5bGUud2lkdGggPSBjc3Mud2lkdGg7XG4gICAgfVxuICAgIGlmIChjc3MuaGVpZ2h0IHx8IGNzcy5oZWlnaHQgPT0gMCkge1xuICAgICAgZWxlLnN0eWxlLmhlaWdodCA9IGNzcy5oZWlnaHQ7XG4gICAgfVxuICAgIGlmIChjc3MuekluZGV4IHx8IGNzcy56SW5kZXggPT0gMCkge1xuICAgICAgZWxlLnN0eWxlLnpJbmRleCA9IGNzcy56SW5kZXg7XG4gICAgfVxuICB9XG4gIHByaXZhdGUgd2luOiBhbnk7XG4gIGlzKHBsYXRmb3JtTmFtZTogUGxhdGZvcm1zKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGlzUGxhdGZvcm0odGhpcy53aW4sIHBsYXRmb3JtTmFtZSk7XG4gIH1cblxuICAvKipcbiAgICog6L+U5Zue5b2T5YmN5bmz5Y+w5ZCN56ewXG4gICAqL1xuICBnZXRQbGF0Zm9ybU5hbWUoKTogc3RyaW5nIHtcblxuICAgIGlmICh0aGlzLmlzQW5kcm9pZCgpKVxuICAgICAgcmV0dXJuICdhbmRyb2lkJztcblxuICAgIGlmICh0aGlzLmlzSW9zKCkpXG4gICAgICByZXR1cm4gJ2lvcyc7XG5cbiAgICBpZiAoIXRoaXMuaXNNb2JpbGUoKSlcbiAgICAgIHJldHVybiAnYnJvd3NlcidcblxuICAgIHJldHVybiAndW5rbm93bic7XG4gIH1cbiAgLyoqXG4gICAqIOaYr+WQpuenu+WKqOerr+eOr+Wig1xuICAgKi9cbiAgaXNNb2JpbGVOb3RUYWJsZXQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNNb2JpbGUoKVxuICAgICAgJiYgdGhpcy5wbGF0Zm9ybS5pcyhcImlwYWRcIikgPT0gZmFsc2VcbiAgICAgICYmIHRoaXMucGxhdGZvcm0uaXMoXCJwaGFibGV0XCIpID09IGZhbHNlXG4gICAgICAmJiB0aGlzLnBsYXRmb3JtLmlzKFwidGFibGV0XCIpID09IGZhbHNlO1xuICB9XG4gIC8qKlxuICAgKiDmmK/lkKbnp7vliqjnq6/njq/looNcbiAgICovXG4gIGlzTW9iaWxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnBsYXRmb3JtLmlzKFwibW9iaWxlXCIpIHx8IHRoaXMucGxhdGZvcm0uaXMoXCJtb2JpbGV3ZWJcIik7XG4gIH1cbiAgLyoqXG4gICAqIOaYr+WQpuecn+acuueOr+Wig1xuICAgKi9cbiAgaXNNb2JpbGVSZWFsTWFjaGluZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5wbGF0Zm9ybS5pcygnbW9iaWxlJykgJiYgIXRoaXMucGxhdGZvcm0uaXMoJ21vYmlsZXdlYicpO1xuICB9XG4gIC8qKlxuICAgKiDmmK/lkKZhbmRyb2lk55yf5py6546v5aKDXG4gICAqL1xuICBpc0FuZHJvaWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNNb2JpbGVSZWFsTWFjaGluZSgpICYmIHRoaXMucGxhdGZvcm0uaXMoJ2FuZHJvaWQnKTtcbiAgfVxuICAvKipcbiAgICog5piv5ZCmaW9z55yf5py6546v5aKDXG4gICAqL1xuICBpc0lvcygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc01vYmlsZVJlYWxNYWNoaW5lKCkgJiYgKHRoaXMucGxhdGZvcm0uaXMoJ2lvcycpIHx8IHRoaXMucGxhdGZvcm0uaXMoJ2lwYWQnKSB8fCB0aGlzLnBsYXRmb3JtLmlzKCdpcGhvbmUnKSk7XG4gIH1cbn1cbiJdfQ==