import { Injectable } from '@angular/core';
import { HttpParams, HttpHeaders } from '@angular/common/http';
import { OrderByType } from '../models/http/request.result';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "../models/models";
export class HttpReqService {
    constructor(httpClient, config) {
        this.httpClient = httpClient;
        this.config = config;
        this.ServiceUrl = '';
        this.headers = new HttpHeaders().set("Content-type", "application/json; charset=UTF-8");
        this._tokenKey = "__token";
        this._tokenValue = "";
        this.ServiceUrl = config.apiRootUrl;
    }
    getLocalToken() {
        if (window.sessionStorage) {
            let str = sessionStorage.getItem(this._tokenKey);
            if (str != "") {
                return JSON.parse(str);
            }
        }
        else {
            console.log("浏览器不支持sessionStorage");
        }
        return null;
    }
    getTokenKey() {
        return this._tokenKey;
    }
    setAccessToken(token) {
        this._tokenValue = token;
    }
    getAccessToken() {
        let token = "";
        if (this._tokenValue) {
            token = this._tokenValue;
        }
        else {
            let m = this.getLocalToken();
            if (m) {
                this.setAccessToken(m.access_token);
                token = m.access_token;
            }
        }
        return token;
    }
    getAuthHeaders() {
        return this.headers.set("Authorization", `Bearer ${this.getAccessToken()}`);
    }
    getJsonFile(configFilePath) {
        return this.httpClient.get(configFilePath, { responseType: 'json' }).toPromise();
    }
    _toHttpParams(paras) {
        if (!paras)
            return null;
        let obj = {};
        paras.forEach(x => {
            obj[x.name] = x.value;
        });
        return new HttpParams({ fromObject: obj });
    }
    _toParaString(para) {
        if (!para || para.length <= 0)
            return '';
        let str = '';
        para.forEach(s => {
            str += `&${s.name}=${s.value}`;
        });
        return str.substring(1);
    }
    _toHttpParams2(para) {
        let _httpParams = null;
        if (typeof para === "string") {
            _httpParams = new HttpParams({ fromString: para });
        }
        else {
            _httpParams = new HttpParams({ fromObject: para });
        }
        return _httpParams;
    }
    _toParaString2(para) {
        if (!para)
            return '';
        if (typeof para === "string") {
            if (para.startsWith("&") || para.startsWith("?")) {
                return para.substring(1);
            }
            return para;
        }
        else {
            let str = '';
            for (const key in para) {
                if (para.hasOwnProperty(key)) {
                    str += `&${key}=${para[key]}`;
                }
            }
            return str.substring(1);
        }
    }
    getNoAuthGeneric(apiName, para, serviceUrl) {
        let url = this.ServiceUrl;
        if (serviceUrl)
            url = serviceUrl;
        return this.httpClient.get(`${url}/${apiName}`, {
            headers: this.headers,
            params: this._toHttpParams2(para)
        }).toPromise();
    }
    getNoAuth(apiName, para, serviceUrl) {
        return this.getNoAuthGeneric(apiName, para, serviceUrl);
    }
    getGeneric(apiName, para, serviceUrl) {
        let url = this.ServiceUrl;
        if (serviceUrl)
            url = serviceUrl;
        return this.httpClient.get(`${url}/${apiName}`, {
            headers: this.getAuthHeaders(),
            params: this._toHttpParams2(para)
        }).toPromise();
    }
    get(apiName, para, serviceUrl) {
        return this.getGeneric(apiName, para, serviceUrl);
    }
    getPage(apiName, pageIndex, pageSize, orderBy, direction, para, serviceUrl) {
        if (pageIndex <= 0) {
            pageIndex = 1;
        }
        if (pageSize <= 0) {
            pageSize = 20;
        }
        let pager = {
            page: pageIndex.toString(),
            size: pageSize.toString(),
            orderby: orderBy ? orderBy : "",
            direction: direction === OrderByType.desc ? "1" : "0"
        };
        let paraString = this._toParaString2(pager);
        if (para) {
            paraString = paraString + "&" + this._toParaString2(para);
        }
        return this.getGeneric(apiName, paraString, serviceUrl);
    }
    postNoAuthGeneric(apiName, para, serviceUrl, receiveAsObject) {
        let url = this.ServiceUrl;
        if (typeof serviceUrl === 'string' && serviceUrl)
            url = serviceUrl;
        if (receiveAsObject === true || (typeof serviceUrl === 'boolean' && serviceUrl === true)) {
            return this.httpClient.post(`${url}/${apiName}`, para, { headers: this.headers }).toPromise();
        }
        else {
            return this.httpClient.post(`${url}/${apiName}`, this._toParaString2(para), {
                headers: {
                    'Content-Type': "application/x-www-form-urlencoded;charset=UTF-8"
                }
            }).toPromise();
        }
    }
    postNoAuth(apiName, para, serviceUrl, receiveAsObject) {
        return this.postNoAuthGeneric(apiName, para, serviceUrl, receiveAsObject);
    }
    postGeneric(apiName, para, serviceUrl, receiveAsObject) {
        let url = this.ServiceUrl;
        if (typeof serviceUrl === 'string' && serviceUrl)
            url = serviceUrl;
        if (receiveAsObject === true || (typeof serviceUrl === 'boolean' && serviceUrl === true)) {
            return this.httpClient.post(`${url}/${apiName}`, para, { headers: this.getAuthHeaders() }).toPromise();
        }
        else {
            return this.httpClient.post(`${url}/${apiName}`, this._toParaString2(para), {
                headers: {
                    'Content-Type': "application/x-www-form-urlencoded;charset=UTF-8",
                    "Authorization": `Bearer ${this.getAccessToken()}`
                }
            }).toPromise();
        }
    }
    post(apiName, para, serviceUrl, receiveAsObject) {
        return this.postGeneric(apiName, para, serviceUrl, receiveAsObject);
    }
    postPage(apiName, pageIndex, pageSize, orderBy, direction, para, serviceUrl, receiveAsObject) {
        if (pageIndex <= 0) {
            pageIndex = 1;
        }
        if (pageSize <= 0) {
            pageSize = 20;
        }
        let pager = {
            page: pageIndex.toString(),
            size: pageSize.toString(),
            orderby: orderBy ? orderBy : "",
            direction: direction === OrderByType.desc ? "1" : "0"
        };
        let paraString = this._toParaString2(pager);
        if (para) {
            paraString = paraString + "&" + this._toParaString2(para);
        }
        return this.postGeneric(apiName, paraString, serviceUrl, receiveAsObject);
    }
    deleteGeneric(apiName, para, serviceUrl) {
        let url = this.ServiceUrl;
        if (serviceUrl)
            url = serviceUrl;
        return this.httpClient.delete(`${url}/${apiName}`, {
            params: this._toHttpParams2(para),
            headers: {
                "Authorization": `Bearer ${this.getAccessToken()}`
            }
        }).toPromise();
    }
    delete(apiName, para, serviceUrl) {
        return this.deleteGeneric(apiName, para, serviceUrl);
    }
}
HttpReqService.ɵfac = function HttpReqService_Factory(t) { return new (t || HttpReqService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.AppGlobalConfig)); };
HttpReqService.ɵprov = i0.ɵɵdefineInjectable({ token: HttpReqService, factory: HttpReqService.ɵfac, providedIn: 'root' });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(HttpReqService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: i1.HttpClient }, { type: i2.AppGlobalConfig }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVxdWVzdC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvZXBzZ2lzL3NlcnZpY2VzL3JlcXVlc3Quc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxVQUFVLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDM0UsT0FBTyxFQUFrQyxXQUFXLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQzs7OztBQU01RixNQUFNLE9BQU8sY0FBYztJQVF2QixZQUNXLFVBQXNCLEVBRXRCLE1BQXVCO1FBRnZCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFFdEIsV0FBTSxHQUFOLE1BQU0sQ0FBaUI7UUFWMUIsZUFBVSxHQUFXLEVBQUUsQ0FBQztRQUNoQyxZQUFPLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQyxHQUFHLENBQzNCLGNBQWMsRUFDZCxpQ0FBaUMsQ0FDcEMsQ0FBQztRQUNNLGNBQVMsR0FBRyxTQUFTLENBQUM7UUFDdEIsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFNckIsSUFBSSxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDO0lBQ3hDLENBQUM7SUFJRCxhQUFhO1FBQ1QsSUFBSSxNQUFNLENBQUMsY0FBYyxFQUFFO1lBQ3ZCLElBQUksR0FBRyxHQUFHLGNBQWMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ2pELElBQUksR0FBRyxJQUFJLEVBQUUsRUFBRTtnQkFDWCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDMUI7U0FDSjthQUFNO1lBQ0gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1NBQ3ZDO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUlELFdBQVc7UUFDUCxPQUFP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USxjQUFjO3NEQUFkLGNBQWMsV0FBZCxjQUFjLG1CQUZYLE1BQU07dUZBRVQsY0FBYztjQUgxQixVQUFVO2VBQUM7Z0JBQ1IsVUFBVSxFQUFFLE1BQU07YUFDckIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwUGFyYW1zLCBIdHRwSGVhZGVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IFJlcXVlc3RSZXN1bHRNb2RlbCwgVG9rZW5Nb2RlbCwgT3JkZXJCeVR5cGUgfSBmcm9tICcuLi9tb2RlbHMvaHR0cC9yZXF1ZXN0LnJlc3VsdCc7XG5pbXBvcnQgeyBBcHBHbG9iYWxDb25maWcgfSBmcm9tICcuLi9tb2RlbHMvbW9kZWxzJztcbi8vIGV4cG9ydCBjb25zdCBBcGlSb290VXJsID0gbmV3IEluamVjdGlvblRva2VuPHN0cmluZz4oJ0FwaVJvb3RVcmwnKTtcbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgSHR0cFJlcVNlcnZpY2Uge1xuICAgIHByaXZhdGUgU2VydmljZVVybDogc3RyaW5nID0gJyc7XG4gICAgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpLnNldChcbiAgICAgICAgXCJDb250ZW50LXR5cGVcIixcbiAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PVVURi04XCJcbiAgICApO1xuICAgIHByaXZhdGUgX3Rva2VuS2V5ID0gXCJfX3Rva2VuXCI7XG4gICAgcHJpdmF0ZSBfdG9rZW5WYWx1ZSA9IFwiXCI7XG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHB1YmxpYyBodHRwQ2xpZW50OiBIdHRwQ2xpZW50LFxuICAgICAgICAvLyBAT3B0aW9uYWwoKSBASW5qZWN0KEFwaVJvb3RVcmwpIHByaXZhdGUgQXBpUm9vdFVybDogc3RyaW5nXG4gICAgICAgIHB1YmxpYyBjb25maWc6IEFwcEdsb2JhbENvbmZpZ1xuICAgICkge1xuICAgICAgICB0aGlzLlNlcnZpY2VVcmwgPSBjb25maWcuYXBpUm9vdFVybDtcbiAgICB9XG4gICAgLyoqXG4gICAgICog6I635Y+W5pys5Zyw5L+d5a2Y55qEdG9rZW5cbiAgICAgKi9cbiAgICBnZXRMb2NhbFRva2VuKCk6IFRva2VuTW9kZWwge1xuICAgICAgICBpZiAod2luZG93LnNlc3Npb25TdG9yYWdlKSB7XG4gICAgICAgICAgICBsZXQgc3RyID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh0aGlzLl90b2tlbktleSk7XG4gICAgICAgICAgICBpZiAoc3RyICE9IFwiXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShzdHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCLmtY/op4jlmajkuI3mlK/mjIFzZXNzaW9uU3RvcmFnZVwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogc2Vzc2lvblN0b3JhZ2XkuK3nmoRrZXlcbiAgICAgKi9cbiAgICBnZXRUb2tlbktleSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Rva2VuS2V5O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiB0b2tlbuabtOaWsOWQjumcgOimgeiwg+eUqOatpOWHveaVsOabtOaWsOacrOWunuS+i+S4reeahOWAvFxuICAgICAqIEBwYXJhbSB0b2tlbiBcbiAgICAgKi9cbiAgICBzZXRBY2Nlc3NUb2tlbih0b2tlbjogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuX3Rva2VuVmFsdWUgPSB0b2tlbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogXG4gICAgICovXG4gICAgZ2V0QWNjZXNzVG9rZW4oKSB7XG4gICAgICAgIGxldCB0b2tlbjogc3RyaW5nID0gXCJcIjtcbiAgICAgICAgaWYgKHRoaXMuX3Rva2VuVmFsdWUpIHtcbiAgICAgICAgICAgIHRva2VuID0gdGhpcy5fdG9rZW5WYWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBtOiBUb2tlbk1vZGVsID0gdGhpcy5nZXRMb2NhbFRva2VuKCk7XG4gICAgICAgICAgICBpZiAobSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QWNjZXNzVG9rZW4obS5hY2Nlc3NfdG9rZW4pO1xuICAgICAgICAgICAgICAgIHRva2VuID0gbS5hY2Nlc3NfdG9rZW47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiDojrflj5bluKbmnIl0b2tlbueahGhlYWRlcnNcbiAgICAgKi9cbiAgICBnZXRBdXRoSGVhZGVycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGVhZGVycy5zZXQoXCJBdXRob3JpemF0aW9uXCIsIGBCZWFyZXIgJHt0aGlzLmdldEFjY2Vzc1Rva2VuKCl9YCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIOivt+axgmpzb27mlofku7ZcbiAgICAgKiBAcGFyYW0gY29uZmlnRmlsZVBhdGggXG4gICAgICovXG4gICAgZ2V0SnNvbkZpbGUoY29uZmlnRmlsZVBhdGg6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldChjb25maWdGaWxlUGF0aCwgeyByZXNwb25zZVR5cGU6ICdqc29uJyB9KS50b1Byb21pc2UoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF90b0h0dHBQYXJhbXMocGFyYXM6IEFycmF5PEh0dHBQYXJhPik6IEh0dHBQYXJhbXMge1xuICAgICAgICBpZiAoIXBhcmFzKSByZXR1cm4gbnVsbDtcbiAgICAgICAgbGV0IG9iaiA9IHt9O1xuICAgICAgICBwYXJhcy5mb3JFYWNoKHggPT4ge1xuICAgICAgICAgICAgb2JqW3gubmFtZV0gPSB4LnZhbHVlO1xuICAgICAgICB9KVxuICAgICAgICByZXR1cm4gbmV3IEh0dHBQYXJhbXMoeyBmcm9tT2JqZWN0OiBvYmogfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFxuICAgICAqIEBwYXJhbSBwYXJhIFxuICAgICAqL1xuICAgIHByaXZhdGUgX3RvUGFyYVN0cmluZyhwYXJhOiBBcnJheTxIdHRwUGFyYT4pOiBzdHJpbmcge1xuICAgICAgICBpZiAoIXBhcmEgfHwgcGFyYS5sZW5ndGggPD0gMCkgcmV0dXJuICcnO1xuICAgICAgICBsZXQgc3RyID0gJyc7XG4gICAgICAgIHBhcmEuZm9yRWFjaChzID0+IHtcbiAgICAgICAgICAgIHN0ciArPSBgJiR7cy5uYW1lfT0ke3MudmFsdWV9YDtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKDEpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gcGFyYSBcbiAgICAgKi9cbiAgICBwcml2YXRlIF90b0h0dHBQYXJhbXMyKHBhcmE6IE9iamVjdFBhcmEgfCBzdHJpbmcpIHtcbiAgICAgICAgbGV0IF9odHRwUGFyYW1zID0gbnVsbDtcbiAgICAgICAgaWYgKHR5cGVvZiBwYXJhID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICBfaHR0cFBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKHsgZnJvbVN0cmluZzogcGFyYSB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF9odHRwUGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoeyBmcm9tT2JqZWN0OiBwYXJhIGFzIE9iamVjdFBhcmEgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF9odHRwUGFyYW1zO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gcGFyYSBcbiAgICAgKi9cbiAgICBwcml2YXRlIF90b1BhcmFTdHJpbmcyKHBhcmE6IE9iamVjdFBhcmEgfCBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBpZiAoIXBhcmEpIHJldHVybiAnJztcbiAgICAgICAgaWYgKHR5cGVvZiBwYXJhID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICBpZiAocGFyYS5zdGFydHNXaXRoKFwiJlwiKSB8fCBwYXJhLnN0YXJ0c1dpdGgoXCI/XCIpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmEuc3Vic3RyaW5nKDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHBhcmE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXQgc3RyID0gJyc7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBwYXJhKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcmEuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBzdHIgKz0gYCYke2tleX09JHtwYXJhW2tleV19YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc3RyLnN1YnN0cmluZygxKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBnZXTor7fmsYJcbiAgICAgKiBAcGFyYW0gYXBpTmFtZSBhcGlcbiAgICAgKiBAcGFyYW0gcGFyYSDlj4LmlbBcbiAgICAgKiBAcGFyYW0gc2VydmljZVVybCDmnI3liqHlnLDlnYBcbiAgICAgKi9cbiAgICBnZXROb0F1dGhHZW5lcmljPFQ+KGFwaU5hbWU6IHN0cmluZywgcGFyYT86IE9iamVjdFBhcmEgfCBzdHJpbmcsIHNlcnZpY2VVcmw/OiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IHVybCA9IHRoaXMuU2VydmljZVVybDtcbiAgICAgICAgaWYgKHNlcnZpY2VVcmwpIHVybCA9IHNlcnZpY2VVcmw7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQuZ2V0PFQ+KGAke3VybH0vJHthcGlOYW1lfWAsIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICAgICAgICAgIC8vcGFyYW1zOiBuZXcgSHR0cFBhcmFtcyh7IGZyb21TdHJpbmc6IHBhcmFTdHJpbmcgfSlcbiAgICAgICAgICAgIHBhcmFtczogdGhpcy5fdG9IdHRwUGFyYW1zMihwYXJhKVxuICAgICAgICB9KS50b1Byb21pc2U8VD4oKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIGFwaU5hbWUgYXBpXG4gICAgICogQHBhcmFtIHBhcmEg5Y+C5pWw5a2X56ym5LiyXG4gICAgICogQHBhcmFtIHNlcnZpY2VVcmwg5pyN5Yqh5Zyw5Z2AXG4gICAgICovXG4gICAgZ2V0Tm9BdXRoKGFwaU5hbWU6IHN0cmluZywgcGFyYT86IE9iamVjdFBhcmEgfCBzdHJpbmcsIHNlcnZpY2VVcmw/OiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Tm9BdXRoR2VuZXJpYzxSZXF1ZXN0UmVzdWx0TW9kZWw+KGFwaU5hbWUsIHBhcmEsIHNlcnZpY2VVcmwpO1xuICAgIH1cbiAgICAvKipcbiAgICAqIGdldOivt+axgi3luKbpqozor4FcbiAgICAqIEBwYXJhbSBhcGlOYW1lIGFwaVxuICAgICogQHBhcmFtIHBhcmEg5Y+C5pWw5a2X56ym5LiyXG4gICAgKiBAcGFyYW0gc2VydmljZVVybCDmnI3liqHlnLDlnYBcbiAgICAqL1xuICAgIGdldEdlbmVyaWM8VD4oYXBpTmFtZTogc3RyaW5nLCBwYXJhPzogT2JqZWN0UGFyYSB8IHN0cmluZywgc2VydmljZVVybD86IHN0cmluZykge1xuICAgICAgICBsZXQgdXJsID0gdGhpcy5TZXJ2aWNlVXJsO1xuICAgICAgICBpZiAoc2VydmljZVVybCkgdXJsID0gc2VydmljZVVybDtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXQ8VD4oYCR7dXJsfS8ke2FwaU5hbWV9YCwge1xuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5nZXRBdXRoSGVhZGVycygpLFxuICAgICAgICAgICAgLy8gcGFyYW1zOiBuZXcgSHR0cFBhcmFtcyh7IGZyb21TdHJpbmc6IHBhcmFTdHJpbmcgfSlcbiAgICAgICAgICAgIHBhcmFtczogdGhpcy5fdG9IdHRwUGFyYW1zMihwYXJhKVxuICAgICAgICB9KS50b1Byb21pc2U8VD4oKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIGFwaU5hbWUgXG4gICAgICogQHBhcmFtIHBhcmEgXG4gICAgICogQHBhcmFtIHNlcnZpY2VVcmwgXG4gICAgICovXG4gICAgZ2V0KGFwaU5hbWU6IHN0cmluZywgcGFyYT86IE9iamVjdFBhcmEgfCBzdHJpbmcsIHNlcnZpY2VVcmw/OiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0R2VuZXJpYzxSZXF1ZXN0UmVzdWx0TW9kZWw+KGFwaU5hbWUsIHBhcmEsIHNlcnZpY2VVcmwpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiDojrflj5bliIbpobXmlbDmja5cbiAgICAgKiBAcGFyYW0gYXBpTmFtZSBcbiAgICAgKiBAcGFyYW0gcGFnZUluZGV4IOmhteeggVxuICAgICAqIEBwYXJhbSBwYWdlU2l6ZSDmr4/pobXlpKflsI9cbiAgICAgKiBAcGFyYW0gb3JkZXJCeSDmjpLluo9cbiAgICAgKiBAcGFyYW0gZGlyZWN0aW9uIOaOkuW6j+aWueWQkVxuICAgICAqIEBwYXJhbSBwYXJhIOWPguaVsFxuICAgICAqIEBwYXJhbSBzZXJ2aWNlVXJsIOiHquWumuS5iXVybFxuICAgICAqL1xuICAgIGdldFBhZ2UoYXBpTmFtZTogc3RyaW5nLCBwYWdlSW5kZXg6IG51bWJlciwgcGFnZVNpemU6IG51bWJlciwgb3JkZXJCeT86IHN0cmluZywgZGlyZWN0aW9uPzogT3JkZXJCeVR5cGUsIHBhcmE/OiBPYmplY3RQYXJhIHwgc3RyaW5nLCBzZXJ2aWNlVXJsPzogc3RyaW5nKSB7XG4gICAgICAgIGlmIChwYWdlSW5kZXggPD0gMCkge1xuICAgICAgICAgICAgcGFnZUluZGV4ID0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFnZVNpemUgPD0gMCkge1xuICAgICAgICAgICAgcGFnZVNpemUgPSAyMDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgcGFnZXI6IE9iamVjdFBhcmEgPSB7XG4gICAgICAgICAgICBwYWdlOiBwYWdlSW5kZXgudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIHNpemU6IHBhZ2VTaXplLnRvU3RyaW5nKCksXG4gICAgICAgICAgICBvcmRlcmJ5OiBvcmRlckJ5ID8gb3JkZXJCeSA6IFwiXCIsXG4gICAgICAgICAgICBkaXJlY3Rpb246IGRpcmVjdGlvbiA9PT0gT3JkZXJCeVR5cGUuZGVzYyA/IFwiMVwiIDogXCIwXCJcbiAgICAgICAgfTtcbiAgICAgICAgbGV0IHBhcmFTdHJpbmcgPSB0aGlzLl90b1BhcmFTdHJpbmcyKHBhZ2VyKTtcbiAgICAgICAgaWYgKHBhcmEpIHtcbiAgICAgICAgICAgIHBhcmFTdHJpbmcgPSBwYXJhU3RyaW5nICsgXCImXCIgKyB0aGlzLl90b1BhcmFTdHJpbmcyKHBhcmEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmdldEdlbmVyaWM8UmVxdWVzdFJlc3VsdE1vZGVsPihhcGlOYW1lLCBwYXJhU3RyaW5nLCBzZXJ2aWNlVXJsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgKiBwb3N06K+35rGCXG4gICAgKiBAcGFyYW0gYXBpTmFtZSDmlrnms5XlkI1cbiAgICAqIEBwYXJhbSBwYXJhIOWPguaVsFxuICAgICogQHBhcmFtIHNlcnZpY2VVcmwg5pyN5Yqh5Zyw5Z2AXG4gICAgKiBAcGFyYW0gcmVjZWl2ZUFzT2JqZWN0IGFwaeaYr+WQpuS7peWvueixoeaOpeaUtuWPguaVsFxuICAgICovXG4gICAgcG9zdE5vQXV0aEdlbmVyaWM8VD4oYXBpTmFtZTogc3RyaW5nLCBwYXJhPzogT2JqZWN0UGFyYSB8IHN0cmluZyB8IGFueSwgc2VydmljZVVybD86IHN0cmluZyB8IGJvb2xlYW4sIHJlY2VpdmVBc09iamVjdD86IGJvb2xlYW4pOiBQcm9taXNlPFQ+IHtcbiAgICAgICAgbGV0IHVybCA9IHRoaXMuU2VydmljZVVybDtcbiAgICAgICAgaWYgKHR5cGVvZiBzZXJ2aWNlVXJsID09PSAnc3RyaW5nJyAmJiBzZXJ2aWNlVXJsKSB1cmwgPSBzZXJ2aWNlVXJsO1xuICAgICAgICBpZiAocmVjZWl2ZUFzT2JqZWN0ID09PSB0cnVlIHx8ICh0eXBlb2Ygc2VydmljZVVybCA9PT0gJ2Jvb2xlYW4nICYmIHNlcnZpY2VVcmwgPT09IHRydWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3Q8VD4oYCR7dXJsfS8ke2FwaU5hbWV9YCwgcGFyYSwgeyBoZWFkZXJzOiB0aGlzLmhlYWRlcnMgfSkudG9Qcm9taXNlPFQ+KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3Q8VD4oXG4gICAgICAgICAgICAgICAgYCR7dXJsfS8ke2FwaU5hbWV9YCxcbiAgICAgICAgICAgICAgICB0aGlzLl90b1BhcmFTdHJpbmcyKHBhcmEpLC8v6KaB5a2X56ym5LiyXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7Y2hhcnNldD1VVEYtOFwiLy/kuZ/lv4XpobvopoHorr7nva7jgILjgILjgILlnZHjgILjgILjgIIgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8scGFyYW1zOiB0aGlzLl90b0h0dHBQYXJhbXMocGFyYSkvL+i/memHjOaYr2dldOWPguaVsFxuICAgICAgICAgICAgICAgIH0pLnRvUHJvbWlzZTxUPigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFxuICAgICAqIEBwYXJhbSBhcGlOYW1lIFxuICAgICAqIEBwYXJhbSBwYXJhIFxuICAgICAqIEBwYXJhbSBzZXJ2aWNlVXJsIFxuICAgICogQHBhcmFtIHJlY2VpdmVBc09iamVjdCBhcGnmmK/lkKbku6Xlr7nosaHmjqXmlLblj4LmlbBcbiAgICAgKi9cbiAgICBwb3N0Tm9BdXRoKGFwaU5hbWU6IHN0cmluZywgcGFyYT86IE9iamVjdFBhcmEgfCBzdHJpbmcgfCBhbnksIHNlcnZpY2VVcmw/OiBzdHJpbmcgfCBib29sZWFuLCByZWNlaXZlQXNPYmplY3Q/OiBib29sZWFuKTogUHJvbWlzZTxSZXF1ZXN0UmVzdWx0TW9kZWw+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdE5vQXV0aEdlbmVyaWM8UmVxdWVzdFJlc3VsdE1vZGVsPihhcGlOYW1lLCBwYXJhLCBzZXJ2aWNlVXJsLCByZWNlaXZlQXNPYmplY3QpO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICAqIHBvc3Tor7fmsYIt5bim6aqM6K+BXG4gICAgICAqIEBwYXJhbSBhcGlOYW1lIOaWueazleWQjVxuICAgICAgKiBAcGFyYW0gcGFyYSDlj4LmlbBcbiAgICAgKiBAcGFyYW0gc2VydmljZVVybCDmnI3liqHlnLDlnYBcbiAgICAqIEBwYXJhbSByZWNlaXZlQXNPYmplY3QgYXBp5piv5ZCm5Lul5a+56LGh5o6l5pS25Y+C5pWwXG4gICAgICAqL1xuICAgIHBvc3RHZW5lcmljPFQ+KGFwaU5hbWU6IHN0cmluZywgcGFyYT86IE9iamVjdFBhcmEgfCBzdHJpbmcgfCBhbnksIHNlcnZpY2VVcmw/OiBzdHJpbmcgfCBib29sZWFuLCByZWNlaXZlQXNPYmplY3Q/OiBib29sZWFuKSB7XG4gICAgICAgIGxldCB1cmwgPSB0aGlzLlNlcnZpY2VVcmw7XG4gICAgICAgIGlmICh0eXBlb2Ygc2VydmljZVVybCA9PT0gJ3N0cmluZycgJiYgc2VydmljZVVybCkgdXJsID0gc2VydmljZVVybDtcbiAgICAgICAgaWYgKHJlY2VpdmVBc09iamVjdCA9PT0gdHJ1ZSB8fCAodHlwZW9mIHNlcnZpY2VVcmwgPT09ICdib29sZWFuJyAmJiBzZXJ2aWNlVXJsID09PSB0cnVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0PFQ+KGAke3VybH0vJHthcGlOYW1lfWAsIHBhcmEsIHsgaGVhZGVyczogdGhpcy5nZXRBdXRoSGVhZGVycygpIH0pLnRvUHJvbWlzZTxUPigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0PFQ+KFxuICAgICAgICAgICAgICAgIGAke3VybH0vJHthcGlOYW1lfWAsXG4gICAgICAgICAgICAgICAgdGhpcy5fdG9QYXJhU3RyaW5nMihwYXJhKSwvL+imgeWtl+espuS4slxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkO2NoYXJzZXQ9VVRGLThcIi8v5Lmf5b+F6aG76KaB6K6+572u44CC44CC44CC5Z2R44CC44CC44CCXG4gICAgICAgICAgICAgICAgICAgICAgICAsIFwiQXV0aG9yaXphdGlvblwiOiBgQmVhcmVyICR7dGhpcy5nZXRBY2Nlc3NUb2tlbigpfWBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyxwYXJhbXM6IHRoaXMuX3RvSHR0cFBhcmFtcyhwYXJhKS8v6L+Z6YeM5pivZ2V05Y+C5pWwXG4gICAgICAgICAgICAgICAgfSkudG9Qcm9taXNlPFQ+KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIGFwaU5hbWUgXG4gICAgICogQHBhcmFtIHBhcmEgXG4gICAgICogQHBhcmFtIHNlcnZpY2VVcmwgXG4gICAgKiBAcGFyYW0gcmVjZWl2ZUFzT2JqZWN0IGFwaeaYr+WQpuS7peWvueixoeaOpeaUtuWPguaVsFxuICAgICAqL1xuICAgIHBvc3QoYXBpTmFtZTogc3RyaW5nLCBwYXJhPzogT2JqZWN0UGFyYSB8IHN0cmluZyB8IGFueSwgc2VydmljZVVybD86IHN0cmluZyB8IGJvb2xlYW4sIHJlY2VpdmVBc09iamVjdD86IGJvb2xlYW4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdEdlbmVyaWM8UmVxdWVzdFJlc3VsdE1vZGVsPihhcGlOYW1lLCBwYXJhLCBzZXJ2aWNlVXJsLCByZWNlaXZlQXNPYmplY3QpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOiOt+WPluWIhumhteaVsOaNrlxuICAgICAqIEBwYXJhbSBhcGlOYW1lIFxuICAgICAqIEBwYXJhbSBwYWdlSW5kZXgg6aG156CBXG4gICAgICogQHBhcmFtIHBhZ2VTaXplIOavj+mhteWkp+Wwj1xuICAgICAqIEBwYXJhbSBvcmRlckJ5IOaOkuW6j1xuICAgICAqIEBwYXJhbSBkaXJlY3Rpb24g5o6S5bqP5pa55ZCRXG4gICAgICogQHBhcmFtIHBhcmEg5Y+C5pWwXG4gICAgICogQHBhcmFtIHNlcnZpY2VVcmwg6Ieq5a6a5LmJdXJsXG4gICAgKiBAcGFyYW0gcmVjZWl2ZUFzT2JqZWN0IGFwaeaYr+WQpuS7peWvueixoeaOpeaUtuWPguaVsFxuICAgICAqL1xuICAgIHBvc3RQYWdlKGFwaU5hbWU6IHN0cmluZywgcGFnZUluZGV4OiBudW1iZXIsIHBhZ2VTaXplOiBudW1iZXIsIG9yZGVyQnk/OiBzdHJpbmcsIGRpcmVjdGlvbj86IE9yZGVyQnlUeXBlLCBwYXJhPzogT2JqZWN0UGFyYSB8IHN0cmluZyB8IGFueSwgc2VydmljZVVybD86IHN0cmluZyB8IGJvb2xlYW4sIHJlY2VpdmVBc09iamVjdD86IGJvb2xlYW4pIHtcbiAgICAgICAgaWYgKHBhZ2VJbmRleCA8PSAwKSB7XG4gICAgICAgICAgICBwYWdlSW5kZXggPSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYWdlU2l6ZSA8PSAwKSB7XG4gICAgICAgICAgICBwYWdlU2l6ZSA9IDIwO1xuICAgICAgICB9XG4gICAgICAgIGxldCBwYWdlcjogT2JqZWN0UGFyYSA9IHtcbiAgICAgICAgICAgIHBhZ2U6IHBhZ2VJbmRleC50b1N0cmluZygpLFxuICAgICAgICAgICAgc2l6ZTogcGFnZVNpemUudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIG9yZGVyYnk6IG9yZGVyQnkgPyBvcmRlckJ5IDogXCJcIixcbiAgICAgICAgICAgIGRpcmVjdGlvbjogZGlyZWN0aW9uID09PSBPcmRlckJ5VHlwZS5kZXNjID8gXCIxXCIgOiBcIjBcIlxuICAgICAgICB9O1xuICAgICAgICBsZXQgcGFyYVN0cmluZyA9IHRoaXMuX3RvUGFyYVN0cmluZzIocGFnZXIpO1xuICAgICAgICBpZiAocGFyYSkge1xuICAgICAgICAgICAgcGFyYVN0cmluZyA9IHBhcmFTdHJpbmcgKyBcIiZcIiArIHRoaXMuX3RvUGFyYVN0cmluZzIocGFyYSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdEdlbmVyaWM8UmVxdWVzdFJlc3VsdE1vZGVsPihhcGlOYW1lLCBwYXJhU3RyaW5nLCBzZXJ2aWNlVXJsLCByZWNlaXZlQXNPYmplY3QpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBkZWxldGXor7fmsYJcbiAgICAgKiBAcGFyYW0gYXBpTmFtZSBcbiAgICAgKiBAcGFyYW0gcGFyYSBcbiAgICAgKiBAcGFyYW0gc2VydmljZVVybCBcbiAgICAgKi9cbiAgICBkZWxldGVHZW5lcmljPFQ+KGFwaU5hbWU6IHN0cmluZywgcGFyYTogT2JqZWN0UGFyYSB8IHN0cmluZywgc2VydmljZVVybD86IHN0cmluZykge1xuICAgICAgICBsZXQgdXJsID0gdGhpcy5TZXJ2aWNlVXJsO1xuICAgICAgICBpZiAoc2VydmljZVVybCkgdXJsID0gc2VydmljZVVybDtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmRlbGV0ZTxUPihgJHt1cmx9LyR7YXBpTmFtZX1gLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHBhcmFtczogdGhpcy5fdG9IdHRwUGFyYW1zMihwYXJhKSxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiQXV0aG9yaXphdGlvblwiOiBgQmVhcmVyICR7dGhpcy5nZXRBY2Nlc3NUb2tlbigpfWBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICkudG9Qcm9taXNlPFQ+KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFxuICAgICAqIEBwYXJhbSBhcGlOYW1lIFxuICAgICAqIEBwYXJhbSBwYXJhIFxuICAgICAqIEBwYXJhbSBzZXJ2aWNlVXJsIFxuICAgICAqL1xuICAgIGRlbGV0ZShhcGlOYW1lOiBzdHJpbmcsIHBhcmE/OiBPYmplY3RQYXJhIHwgc3RyaW5nLCBzZXJ2aWNlVXJsPzogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlbGV0ZUdlbmVyaWM8UmVxdWVzdFJlc3VsdE1vZGVsPihhcGlOYW1lLCBwYXJhLCBzZXJ2aWNlVXJsKTtcbiAgICB9XG59XG5pbnRlcmZhY2UgSHR0cFBhcmEge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICB2YWx1ZTogYW55O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE9iamVjdFBhcmEge1xuICAgIFtwYXJhbTogc3RyaW5nXTogc3RyaW5nIHwgUmVhZG9ubHlBcnJheTxzdHJpbmc+O1xufSJdfQ==