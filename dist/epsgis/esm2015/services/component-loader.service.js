import { Injectable, Injector } from '@angular/core';
import { findComponentInfo } from '../decorator/component-register.decorator';
import * as i0 from "@angular/core";
export class ComponentLoaderService {
    constructor(componentFactoryResolver) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.viewContainerInHome = null;
        this.viewContainerInMap = null;
        this.serviceInjector = null;
        this.factories = null;
        this.factoriesArray = null;
        this.factories = this.componentFactoryResolver["_factories"];
        if (this.factories) {
            this.factoriesArray = Array.from(this.factories);
        }
    }
    createComponent(component, params, container) {
        let inputs = {};
        if (params) {
            inputs = params;
        }
        let inputProviders = Object.keys(inputs).map((inputName) => {
            return { provide: inputName, useValue: inputs[inputName] };
        });
        const injector = Injector.create({ providers: inputProviders, parent: container === null || container === void 0 ? void 0 : container.parentInjector });
        const factory = this.componentFactoryResolver.resolveComponentFactory(component);
        const compRef = factory.create(injector);
        if (typeof compRef.instance.setServiceInjector === "function") {
            compRef.instance.setServiceInjector(this.serviceInjector);
        }
        return compRef;
    }
    getComponentPath(name) {
        const compInfo = findComponentInfo(name);
        if (compInfo) {
            return compInfo.path || compInfo.uri;
        }
        const comp = this.findComponent(name);
        if (comp) {
            return (typeof comp.getCompInfo === "function") ? comp.getCompInfo().path : "";
        }
        return "";
    }
    findComponent(name) {
        let comp = null;
        if (this.factories) {
            if (!this.factories || this.factories.size <= 0)
                return null;
            let item = this.factoriesArray.find((value, index, arr) => {
                return value[1].selector.toLowerCase() === name.toLowerCase();
            });
            if (item) {
                comp = item[0];
            }
        }
        else {
            const compInfo = findComponentInfo(name);
            if (compInfo) {
                return compInfo.component;
            }
        }
        return comp;
    }
    getServiceInjector() {
        return this.serviceInjector;
    }
    setServiceInjector(serviceInjector) {
        this.serviceInjector = serviceInjector;
    }
    setViewContainerInHome(container) {
        this.viewContainerInHome = container;
    }
    createComponentToHome(component, params) {
        return this.createComponent(component, params, this.viewContainerInHome);
    }
    showInHome(compRef) {
        if (!compRef) {
            return;
        }
        if (!this.viewContainerInHome) {
            console.error("未设置容器，无法显示组件");
            return;
        }
        this.viewContainerInHome.insert(compRef.hostView);
    }
    setViewContainerInMap(container) {
        this.viewContainerInMap = container;
    }
    createComponentToMap(component, params) {
        return this.createComponent(component, params, this.viewContainerInMap);
    }
    showInMap(compRef) {
        if (!compRef) {
            return;
        }
        if (!this.viewContainerInMap) {
            console.error("未设置容器，无法显示组件");
            return;
        }
        this.viewContainerInMap.insert(compRef.hostView);
    }
    ngOnDestroy() {
        if (this.viewContainerInHome) {
            this.viewContainerInHome.clear();
        }
        if (this.viewContainerInMap) {
            this.viewContainerInMap.clear();
        }
    }
}
ComponentLoaderService.ɵfac = function ComponentLoaderService_Factory(t) { return new (t || ComponentLoaderService)(i0.ɵɵinject(i0.ComponentFactoryResolver)); };
ComponentLoaderService.ɵprov = i0.ɵɵdefineInjectable({ token: ComponentLoaderService, factory: ComponentLoaderService.ɵfac, providedIn: 'root' });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(ComponentLoaderService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: i0.ComponentFactoryResolver }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LWxvYWRlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvZXBzZ2lzL3NlcnZpY2VzL2NvbXBvbmVudC1sb2FkZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUE2RSxRQUFRLEVBQXVELE1BQU0sZUFBZSxDQUFDO0FBQ3JMLE9BQU8sRUFBcUIsaUJBQWlCLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQzs7QUFRakcsTUFBTSxPQUFPLHNCQUFzQjtJQVkvQixZQUNZLHdCQUFrRDtRQUFsRCw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO1FBVDlELHdCQUFtQixHQUFxQixJQUFJLENBQUM7UUFJN0MsdUJBQWtCLEdBQXFCLElBQUksQ0FBQztRQUNwQyxvQkFBZSxHQUFvQixJQUFJLENBQUM7UUFDaEQsY0FBUyxHQUFHLElBQUksQ0FBQztRQUNqQixtQkFBYyxHQUFlLElBQUksQ0FBQztRQVc5QixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUM3RCxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDaEIsSUFBSSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUNwRDtJQUNMLENBQUM7SUFPTSxlQUFlLENBQUMsU0FBb0IsRUFBRSxNQUFZLEVBQUUsU0FBNEI7UUFFbkYsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLElBQUksTUFBTSxFQUFFO1lBQ1IsTUFBTSxHQUFHLE1BQU0sQ0FBQztTQUNuQjtRQUNELElBQUksY0FBYyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsU0FBUyxFQUFFLEVBQUU7WUFDdkQsT0FBTyxFQUFFLE9BQU8sRUFBRSxTQUFT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QU07YUFDckIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIFR5cGUsIFZpZXdDb250YWluZXJSZWYsIE9uRGVzdHJveSwgQ29tcG9uZW50UmVmLCBJbmplY3RvciwgZm9yd2FyZFJlZiwgSW5qZWN0LCBFbWJlZGRlZFZpZXdSZWYsIEFwcGxpY2F0aW9uUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvbXBvbmVudFJlZ2lzdHJ5LCBmaW5kQ29tcG9uZW50SW5mbyB9IGZyb20gJy4uL2RlY29yYXRvci9jb21wb25lbnQtcmVnaXN0ZXIuZGVjb3JhdG9yJztcclxuaW1wb3J0IHsgU2VydmljZUluamVjdG9yIH0gZnJvbSAnLi9zZXJ2aWNlLWluamVjdG9yJztcclxuLyoqXHJcbiAqIGNyZWF0ZSBieSBydWlyIDE5MTAxOCAg57uE5Lu25Yqg6L295ZmoXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSh7XHJcbiAgICBwcm92aWRlZEluOiAncm9vdCdcclxufSlcclxuZXhwb3J0IGNsYXNzIENvbXBvbmVudExvYWRlclNlcnZpY2UgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xyXG4gICAgLyoqXHJcbiAgICAgKiDmnIDlpJblsYLlrrnlmahcclxuICAgICAqL1xyXG4gICAgdmlld0NvbnRhaW5lckluSG9tZTogVmlld0NvbnRhaW5lclJlZiA9IG51bGw7XHJcbiAgICAvKipcclxuICAgICAqIOWcsOWbvue7hOS7tuS4reeahOWuueWZqFxyXG4gICAgICovXHJcbiAgICB2aWV3Q29udGFpbmVySW5NYXA6IFZpZXdDb250YWluZXJSZWYgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBzZXJ2aWNlSW5qZWN0b3I6IFNlcnZpY2VJbmplY3RvciA9IG51bGw7XHJcbiAgICBmYWN0b3JpZXMgPSBudWxsO1xyXG4gICAgZmFjdG9yaWVzQXJyYXk6IEFycmF5PGFueT4gPSBudWxsO1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlclxyXG4gICAgICAgIC8vICxwcml2YXRlIGFwcGxpY2F0aW9uUmVmOiBBcHBsaWNhdGlvblJlZixcclxuICAgICAgICAvLywgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IFNlcnZpY2VJbmplY3RvcikpXHJcbiAgICAgICAgLy8gIHByaXZhdGUgc2VydmljZUluamVjdG9yOiBTZXJ2aWNlSW5qZWN0b3JcclxuICAgICkge1xyXG4gICAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIC8vICAgICBsZXQgaW5qZWN0b3IgPSBSZWZsZWN0aXZlSW5qZWN0b3IucmVzb2x2ZUFuZENyZWF0ZShbU2VydmljZUluamVjdG9yXSk7XHJcbiAgICAgICAgLy8gICAgIGxldCBkZXBlbmRlbmNlMSA9IGluamVjdG9yLmdldChTZXJ2aWNlSW5qZWN0b3IsIG51bGwpO1xyXG4gICAgICAgIC8vIH0sIDUwMCk7XHJcbiAgICAgICAgdGhpcy5mYWN0b3JpZXMgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcltcIl9mYWN0b3JpZXNcIl07XHJcbiAgICAgICAgaWYgKHRoaXMuZmFjdG9yaWVzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmFjdG9yaWVzQXJyYXkgPSBBcnJheS5mcm9tKHRoaXMuZmFjdG9yaWVzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7uue7hOS7tlxyXG4gICAgICogQHBhcmFtIGNvbXBvbmVudCDnu4Tku7ZcclxuICAgICAqIEBwYXJhbSBwYXJhbXMg5Y+C5pWwXHJcbiAgICAgKiBAcGFyYW0gY29udGFpbmVyIOWuueWZqFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgY3JlYXRlQ29tcG9uZW50KGNvbXBvbmVudDogVHlwZTxhbnk+LCBwYXJhbXM/OiBhbnksIGNvbnRhaW5lcj86IFZpZXdDb250YWluZXJSZWYpIHtcclxuXHJcbiAgICAgICAgbGV0IGlucHV0cyA9IHt9O1xyXG4gICAgICAgIGlmIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgaW5wdXRzID0gcGFyYW1zO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgaW5wdXRQcm92aWRlcnMgPSBPYmplY3Qua2V5cyhpbnB1dHMpLm1hcCgoaW5wdXROYW1lKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHByb3ZpZGU6IGlucHV0TmFtZSwgdXNlVmFsdWU6IGlucHV0c1tpbnB1dE5hbWVdIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy/ov4fml7ZcclxuICAgICAgICAvL0luamVjdG9yLmNyZWF0ZShpbnB1dFByb3ZpZGVycylcclxuICAgICAgICAvL+i/h+aXtlxyXG4gICAgICAgIC8vIGNvbnN0IHJlc29sdmVkSW5wdXRzID0gUmVmbGVjdGl2ZUluamVjdG9yLnJlc29sdmUoaW5wdXRQcm92aWRlcnMpO1xyXG4gICAgICAgIC8vIGNvbnN0IHJlc29sdmVkSW5wdXRzPSBJbmplY3Rvci5jcmVhdGUoe1xyXG4gICAgICAgIC8vICAgICBwcm92aWRlcnM6aW5wdXRQcm92aWRlcnNcclxuICAgICAgICAvLyB9KVxyXG4gICAgICAgIC8vIGxldCBwYXJlbnQgPSBudWxsO1xyXG4gICAgICAgIC8vIGlmIChjb250YWluZXIpIHtcclxuICAgICAgICAvLyAgICAgcGFyZW50ID0gY29udGFpbmVyLnBhcmVudEluamVjdG9yO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyBjb25zdCBpbmplY3RvciA9IFJlZmxlY3RpdmVJbmplY3Rvci5mcm9tUmVzb2x2ZWRQcm92aWRlcnMocmVzb2x2ZWRJbnB1dHMsIHBhcmVudCk7XHJcbiAgICAgICAgY29uc3QgaW5qZWN0b3IgPSBJbmplY3Rvci5jcmVhdGUoeyBwcm92aWRlcnM6IGlucHV0UHJvdmlkZXJzLCBwYXJlbnQ6IGNvbnRhaW5lcj8ucGFyZW50SW5qZWN0b3IgfSk7XHJcbiAgICAgICAgY29uc3QgZmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGNvbXBvbmVudCk7XHJcbiAgICAgICAgLy8gY29udGFpbmVyPy5jcmVhdGVDb21wb25lbnQoZmFjdG9yeSwwLGluamVjdG9yKTtcclxuICAgICAgICBjb25zdCBjb21wUmVmID0gZmFjdG9yeS5jcmVhdGUoaW5qZWN0b3IpO1xyXG4gICAgICAgIGlmICh0eXBlb2YgY29tcFJlZi5pbnN0YW5jZS5zZXRTZXJ2aWNlSW5qZWN0b3IgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICBjb21wUmVmLmluc3RhbmNlLnNldFNlcnZpY2VJbmplY3Rvcih0aGlzLnNlcnZpY2VJbmplY3Rvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuYXBwbGljYXRpb25SZWYuYXR0YWNoVmlldyhjb21wUmVmLmhvc3RWaWV3KTtcclxuICAgICAgICByZXR1cm4gY29tcFJlZjtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W57uE5Lu255qE6Lev5b6EXHJcbiAgICAgKiBAcGFyYW0gbmFtZSDnu4Tku7bnmoRzZWxlY3RvclxyXG4gICAgICovXHJcbiAgICBnZXRDb21wb25lbnRQYXRoKG5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGNvbXBJbmZvID0gZmluZENvbXBvbmVudEluZm8obmFtZSk7XHJcbiAgICAgICAgaWYgKGNvbXBJbmZvKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb21wSW5mby5wYXRoIHx8IGNvbXBJbmZvLnVyaTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgY29tcCA9IHRoaXMuZmluZENvbXBvbmVudChuYW1lKTtcclxuICAgICAgICBpZiAoY29tcCkge1xyXG4gICAgICAgICAgICByZXR1cm4gKHR5cGVvZiBjb21wLmdldENvbXBJbmZvID09PSBcImZ1bmN0aW9uXCIpID8gY29tcC5nZXRDb21wSW5mbygpLnBhdGggOiBcIlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5p+l5om+57uE5Lu2XHJcbiAgICAgKiBAcGFyYW0gbmFtZSDnu4Tku7bnmoRzZWxlY3RvclxyXG4gICAgICovXHJcbiAgICBmaW5kQ29tcG9uZW50KG5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBjb21wID0gbnVsbDtcclxuICAgICAgICBpZiAodGhpcy5mYWN0b3JpZXMpIHtcclxuICAgICAgICAgICAgLy9uZzhcclxuICAgICAgICAgICAgLy9sZXQgZmFjdG9yaWVzOiBBcnJheTxhbnk+ID1BcnJheS5mcm9tKCB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcltcIl9mYWN0b3JpZXNcIl0udmFsdWVzKCkpO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZmFjdG9yaWVzIHx8IHRoaXMuZmFjdG9yaWVzLnNpemUgPD0gMCkgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIC8vQXJyYXkuZnJvbShmYWN0b3JpZXMpWzBdICAwOmNsYXNzIDE6Q29tcG9uZW50RmFjdG9yeV9cclxuICAgICAgICAgICAgLy9bLi4uZmFjdG9yaWVzLnZhbHVlcygpXSBDb21wb25lbnRGYWN0b3J5X1xyXG4gICAgICAgICAgICAvKlxyXG4gICAgICAgICAgICBmYWN0b3JpZXMuZm9yRWFjaCgodmFsdWU6IGFueSwga2V5OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vdmFsdWUuY29tcG9uZW50VHlwZS5uYW1lIFwiT25TY3JlZW5XaWRnZXRJY29uQ29tcG9uZW50XCJcclxuICAgICAgICAgICAgICAgIC8vdmFsdWUuc2VsZWN0b3IgXCJlcHNnaXMtb24tc2NyZWVuLXdpZGdldC1pY29uXCJcclxuICAgICAgICAgICAgICAgIGxldCBfY25hbWU6IHN0cmluZyA9IGtleS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgLy9rZXkgOk56RHJvcGRvd25Db250ZXh0Q29tcG9uZW50XHJcbiAgICAgICAgICAgICAgICBpZiAoX2NuYW1lLnRvTG93ZXJDYXNlKCkgIT09IG5hbWUudG9Mb3dlckNhc2UoKSAmJiB0eXBlb2Yga2V5LmdldENvbXBJbmZvID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBfY25hbWUgPSBrZXkuZ2V0Q29tcEluZm8oKS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coX2NuYW1lKTtcclxuICAgICAgICAgICAgICAgIGlmIChfY25hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZS50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tcCA9IGtleTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICovXHJcblxyXG4gICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuZmFjdG9yaWVzQXJyYXkuZmluZCgodmFsdWUsIGluZGV4OiBudW1iZXIsIGFycikgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhgdmFsdWVbMF0ubmFtZToke3ZhbHVlWzBdLm5hbWV9YCk7IC8v5Y+Y5LqGXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGB2YWx1ZVsxXS5jb21wb25lbnRUeXBlLm5hbWU6JHt2YWx1ZVsxXS5jb21wb25lbnRUeXBlLm5hbWV9YCk7IC8v5Y+Y5LqGXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGB2YWx1ZVsxXS5zZWxlY3Rvcjoke3ZhbHVlWzFdLnNlbGVjdG9yfWApOyAvL1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlWzFdLnNlbGVjdG9yLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBjb21wID0gaXRlbVswXTtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoY29tcC5nZXRDb21wSW5mbygpKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvL25nOeWPiuS7peS4ilxyXG4gICAgICAgICAgICBjb25zdCBjb21wSW5mbyA9IGZpbmRDb21wb25lbnRJbmZvKG5hbWUpO1xyXG4gICAgICAgICAgICBpZiAoY29tcEluZm8pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb21wSW5mby5jb21wb25lbnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNvbXA7XHJcblxyXG4gICAgfVxyXG4gICAgZ2V0U2VydmljZUluamVjdG9yKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2VJbmplY3RvcjtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0gc2VydmljZUluamVjdG9yIFxyXG4gICAgICovXHJcbiAgICBzZXRTZXJ2aWNlSW5qZWN0b3Ioc2VydmljZUluamVjdG9yOiBTZXJ2aWNlSW5qZWN0b3IpIHtcclxuICAgICAgICB0aGlzLnNlcnZpY2VJbmplY3RvciA9IHNlcnZpY2VJbmplY3RvcjtcclxuICAgIH1cclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgLyoqXHJcbiAgICAgKiDorr7nva7nu4Tku7blrrnlmahcclxuICAgICAqIEBwYXJhbSBjb250YWluZXIgXHJcbiAgICAgKi9cclxuICAgIHNldFZpZXdDb250YWluZXJJbkhvbWUoY29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmKSB7XHJcbiAgICAgICAgdGhpcy52aWV3Q29udGFpbmVySW5Ib21lID0gY29udGFpbmVyO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7rnu4Tku7ZcclxuICAgICAqIEBwYXJhbSBjb21wb25lbnQg57uE5Lu2XHJcbiAgICAgKiBAcGFyYW0gcGFyYW1zIOWPguaVsFxyXG4gICAgICovXHJcbiAgICBjcmVhdGVDb21wb25lbnRUb0hvbWUoY29tcG9uZW50OiBUeXBlPGFueT4sIHBhcmFtcz86IGFueSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUNvbXBvbmVudChjb21wb25lbnQsIHBhcmFtcywgdGhpcy52aWV3Q29udGFpbmVySW5Ib21lKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5pi+56S657uE5Lu2XHJcbiAgICAgKi9cclxuICAgIHNob3dJbkhvbWUoY29tcFJlZjogQ29tcG9uZW50UmVmPGFueT4pIHtcclxuICAgICAgICBpZiAoIWNvbXBSZWYpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMudmlld0NvbnRhaW5lckluSG9tZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi5pyq6K6+572u5a655Zmo77yM5peg5rOV5pi+56S657uE5Lu2XCIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudmlld0NvbnRhaW5lckluSG9tZS5pbnNlcnQoY29tcFJlZi5ob3N0Vmlldyk7XHJcbiAgICB9XHJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDorr7nva7nu4Tku7blrrnlmahcclxuICAgICAqIEBwYXJhbSBjb250YWluZXIgXHJcbiAgICAgKi9cclxuICAgIHNldFZpZXdDb250YWluZXJJbk1hcChjb250YWluZXI6IFZpZXdDb250YWluZXJSZWYpIHtcclxuICAgICAgICB0aGlzLnZpZXdDb250YWluZXJJbk1hcCA9IGNvbnRhaW5lcjtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu657uE5Lu25Yiw5Zyw5Zu+57uE5Lu25LitXHJcbiAgICAgKiBAcGFyYW0gY29tcG9uZW50IOe7hOS7tlxyXG4gICAgICogQHBhcmFtIHBhcmFtcyDlj4LmlbBcclxuICAgICAqL1xyXG4gICAgY3JlYXRlQ29tcG9uZW50VG9NYXAoY29tcG9uZW50OiBUeXBlPGFueT4sIHBhcmFtcz86IGFueSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUNvbXBvbmVudChjb21wb25lbnQsIHBhcmFtcywgdGhpcy52aWV3Q29udGFpbmVySW5NYXApO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDmmL7npLrnu4Tku7bvvIjnm7jlr7nkuo7lnLDlm77nu4Tku7bvvIlcclxuICAgICAqL1xyXG4gICAgc2hvd0luTWFwKGNvbXBSZWY6IENvbXBvbmVudFJlZjxhbnk+KSB7XHJcbiAgICAgICAgaWYgKCFjb21wUmVmKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLnZpZXdDb250YWluZXJJbk1hcCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi5pyq6K6+572u5a655Zmo77yM5peg5rOV5pi+56S657uE5Lu2XCIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudmlld0NvbnRhaW5lckluTWFwLmluc2VydChjb21wUmVmLmhvc3RWaWV3KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKi9cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLnZpZXdDb250YWluZXJJbkhvbWUpIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3Q29udGFpbmVySW5Ib21lLmNsZWFyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnZpZXdDb250YWluZXJJbk1hcCkge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdDb250YWluZXJJbk1hcC5jbGVhcigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=