export class GISAuthService {
    static decrypt(str, pwd) {
        try {
            if (str == '') {
                return '';
            }
            if (!pwd || pwd == '') {
                pwd = 'sunway_webgis_auth_code';
            }
            pwd = encodeURIComponent(pwd);
            if (str == undefined || str.length < 8) {
                return '';
            }
            if (pwd == undefined || pwd.length <= 0) {
                return '';
            }
            var prand = '';
            for (var i = 0, len = pwd.length; i < len; i += 1) {
                prand += pwd.charCodeAt(i).toString();
            }
            var sPos = Math.floor(prand.length / 5);
            var mult = parseInt(prand.charAt(sPos) + prand.charAt(sPos * 2) + prand.charAt(sPos * 3) +
                prand.charAt(sPos * 4) + prand.charAt(sPos * 5));
            var incr = Math.round(pwd.length / 2);
            var modu = Math.pow(2, 31) - 1;
            var salt = parseInt(str.substring(str.length - 8, str.length), 16);
            str = str.substring(0, str.length - 8);
            prand += salt;
            while (prand.length > 10) {
                prand = (parseInt(prand.substring(0, 10)) +
                    parseInt(prand.substring(10, prand.length))).toString();
            }
            if (this.isIE()) {
                prand++;
            }
            prand = (mult * prand + incr) % modu;
            var encChr = '';
            var encStr = '';
            for (var i = 0, len = str.length; i < len; i += 2) {
                encChr = parseInt(str.substring(i, i + 2), 16) ^ Math.floor((prand / modu) * 255);
                encStr += String.fromCharCode(encChr);
                prand = (mult * prand + incr) % modu;
            }
            return decodeURIComponent(encStr);
        }
        catch (error) {
            return "";
        }
    }
    static validateAuth(encryptCode) {
        setTimeout(() => {
            this.doValidateAuth(encryptCode);
        }, 0);
    }
    static doValidateAuth(encryptCode) {
        this.encryptCode = encryptCode;
        var enCodeStr = this.decrypt(this.encryptCode);
        var hosts = enCodeStr.split('|')[0];
        var deadline = enCodeStr.split('|')[1];
        this.authtype = enCodeStr.split('|')[2];
        let hostname = window.location.hostname.toUpperCase();
        if (hostname === "LOCALHOST") {
            return;
        }
        var bHostPass = false;
        var hostArry = hosts.split(',');
        hostArry.forEach(host => {
            if (host.toUpperCase() === hostname) {
                bHostPass = true;
                return;
            }
        });
        if (!bHostPass) {
            this.showAuthDlg("软件未授权，请联系软件提供商，获取授权码！");
            return;
        }
        if (typeof (deadline) == "undefined") {
            this.showAuthDlg("软件未授权，请联系软件提供商，获取授权码！");
        }
        var oDate1 = this.getServerDate();
        var oDate2 = new Date(deadline);
        if (oDate1.getTime() > oDate2.getTime()) {
            this.showAuthDlg(this.authtype + "有限期至【" + deadline + "】" + "已过期，请重新授权！@山维科技");
        }
        if (this.authtype != "正式版") {
            this.showAuthInfo("开发预览版，有限期至【" + deadline + "】" + "@山维科技");
        }
    }
    static isIE() {
        if (!!window["ActiveXObject"] || "ActiveXObject" in window) {
            return true;
        }
        else {
            return false;
        }
    }
    static getServerDate() {
        var xhr = null;
        if (window['XMLHttpRequest']) {
            xhr = new window['XMLHttpRequest']();
        }
        else {
            xhr = new window["ActiveXObject"]("Microsoft");
        }
        xhr.open("GET", "/", false);
        xhr.send(null);
        var date = xhr.getResponseHeader("Date");
        return new Date(date);
    }
    static showAuthInfo(msg) {
        var chObj = document.getElementById("copyrightinfo");
        if (chObj) {
            chObj.innerHTML = msg;
        }
        else {
            var node = document.createElement("div");
            node.id = "copyrightinfo";
            node.style.position = "absolute";
            node.style.bottom = "0px";
            node.style.right = "20px";
            node.style.fontSize = "14px";
            node.style.zIndex = "700";
            node.style.color = "#e51c23";
            var textnode = document.createTextNode(msg);
            node.appendChild(textnode);
            document.body.appendChild(node);
        }
    }
    static showAuthDlg(msg) {
        var chObj = document.getElementById("copyDlginfo");
        if (!chObj) {
            var oMask = document.createElement("div");
            oMask.id = "mask";
            oMask.style.background = "#000";
            oMask.style.opacity = "0.65";
            oMask.style.width = "100%";
            oMask.style.position = "absolute";
            oMask.style.left = "0";
            oMask.style.top = "0";
            oMask.style.bottom = "0";
            oMask.style.zIndex = "1000";
            document.body.appendChild(oMask);
            var html = '<div style="text-align:center; margin-top:150px;"><p style="color:red">' + msg + '</p><a href="#" id="hideWin">刷新</a> </div>';
            var node = document.createElement("div");
            node.id = "copyDlginfo";
            node.style.position = "absolute";
            node.style.top = "0";
            node.style.right = "0";
            node.style.bottom = "0";
            node.style.left = "0";
            node.style.margin = "auto";
            node.style.fontSize = "14px";
            node.style.borderRadius = "20px";
            node.style.zIndex = "1001";
            node.style.width = "500px";
            node.style.height = "300px";
            node.style.color = "#e51c23";
            node.style.background = "#fff";
            node.innerHTML = html;
            document.body.appendChild(node);
            document.getElementById('hideWin').onclick = function () {
                window.location.reload();
            };
        }
    }
}
GISAuthService.message = "请获取开发授权！";
GISAuthService.authtype = "开发版";
GISAuthService.encryptCode = "";
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2lzLWF1dGguc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL2Vwc2dpcy9zZXJ2aWNlcy9naXMtYXV0aC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sT0FBTyxjQUFjO0lBSXpCLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBVyxFQUFFLEdBQStCO1FBQ3pELElBQUk7WUFDRixJQUFJLEdBQUcsSUFBSSxFQUFFLEVBQUU7Z0JBQ2IsT0FBTyxFQUFFLENBQUM7YUFDWDtZQUNELElBQUksQ0FBQyxHQUFHLElBQUksR0FBRyxJQUFJLEVBQUUsRUFBRTtnQkFDckIsR0FBRyxHQUFHLHlCQUF5QixDQUFDO2FBQ2pDO1lBQ0QsR0FBRyxHQUFHLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzlCLElBQUksR0FBRyxJQUFJLFNBQVMsSUFBSSxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDdEMsT0FBTyxFQUFFLENBQUM7YUFDWDtZQUNELElBQUksR0FBRyxJQUFJLFNBQVMsSUFBSSxHQUFHLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRTtnQkFDdkMsT0FBTyxFQUFFLENBQUM7YUFDWDtZQUNELElBQUksS0FBSyxHQUFRLEVBQUUsQ0FBQztZQUNwQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ2pELEtBQUssSUFBSSxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO2FBQ3ZDO1lBQ0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3hDLElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENB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LEtBQUssQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFBO1lBQzNCLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQztZQUM3QixJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUM7WUFHL0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7WUFDdEIsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7WUFhaEMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLEdBQUc7Z0JBQzNDLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDM0IsQ0FBQyxDQUFBO1NBQ0Y7SUFDSCxDQUFDOztBQXhNTSxzQkFBTyxHQUFXLFVBQVUsQ0FBQztBQUM3Qix1QkFBUSxHQUFXLEtBQUssQ0FBQztBQUN6QiwwQkFBVyxHQUFXLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBHSVNBdXRoU2VydmljZSB7XG4gIHN0YXRpYyBtZXNzYWdlOiBzdHJpbmcgPSBcIuivt+iOt+WPluW8gOWPkeaOiOadg++8gVwiO1xuICBzdGF0aWMgYXV0aHR5cGU6IHN0cmluZyA9IFwi5byA5Y+R54mIXCI7XG4gIHN0YXRpYyBlbmNyeXB0Q29kZTogc3RyaW5nID0gXCJcIjtcbiAgc3RhdGljIGRlY3J5cHQoc3RyOiBzdHJpbmcsIHB3ZD86IHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4pIHtcbiAgICB0cnkge1xuICAgICAgaWYgKHN0ciA9PSAnJykge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgICB9XG4gICAgICBpZiAoIXB3ZCB8fCBwd2QgPT0gJycpIHtcbiAgICAgICAgcHdkID0gJ3N1bndheV93ZWJnaXNfYXV0aF9jb2RlJztcbiAgICAgIH1cbiAgICAgIHB3ZCA9IGVuY29kZVVSSUNvbXBvbmVudChwd2QpO1xuICAgICAgaWYgKHN0ciA9PSB1bmRlZmluZWQgfHwgc3RyLmxlbmd0aCA8IDgpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgICAgfVxuICAgICAgaWYgKHB3ZCA9PSB1bmRlZmluZWQgfHwgcHdkLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICAgIH1cbiAgICAgIHZhciBwcmFuZDogYW55ID0gJyc7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcHdkLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAxKSB7XG4gICAgICAgIHByYW5kICs9IHB3ZC5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKCk7XG4gICAgICB9XG4gICAgICB2YXIgc1BvcyA9IE1hdGguZmxvb3IocHJhbmQubGVuZ3RoIC8gNSk7XG4gICAgICB2YXIgbXVsdCA9IHBhcnNlSW50KHByYW5kLmNoYXJBdChzUG9zKSArIHByYW5kLmNoYXJBdChzUG9zICogMikgKyBwcmFuZC5jaGFyQXQoc1BvcyAqIDMpICtcbiAgICAgICAgcHJhbmQuY2hhckF0KHNQb3MgKiA0KSArIHByYW5kLmNoYXJBdChzUG9zICogNSkpO1xuICAgICAgdmFyIGluY3IgPSBNYXRoLnJvdW5kKHB3ZC5sZW5ndGggLyAyKTtcbiAgICAgIHZhciBtb2R1ID0gTWF0aC5wb3coMiwgMzEpIC0gMTtcbiAgICAgIHZhciBzYWx0ID0gcGFyc2VJbnQoc3RyLnN1YnN0cmluZyhzdHIubGVuZ3RoIC0gOCwgc3RyLmxlbmd0aCksIDE2KTtcbiAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgc3RyLmxlbmd0aCAtIDgpO1xuICAgICAgcHJhbmQgKz0gc2FsdDtcbiAgICAgIHdoaWxlIChwcmFuZC5sZW5ndGggPiAxMCkge1xuICAgICAgICBwcmFuZCA9IChwYXJzZUludChwcmFuZC5zdWJzdHJpbmcoMCwgMTApKSArXG4gICAgICAgICAgcGFyc2VJbnQocHJhbmQuc3Vic3RyaW5nKDEwLCBwcmFuZC5sZW5ndGgpKSkudG9TdHJpbmcoKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmlzSUUoKSkge1xuICAgICAgICBwcmFuZCsrO1xuICAgICAgfVxuICAgICAgcHJhbmQgPSAobXVsdCAqIHByYW5kICsgaW5jcikgJSBtb2R1O1xuICAgICAgdmFyIGVuY0NocjogYW55ID0gJyc7XG4gICAgICB2YXIgZW5jU3RyOiBhbnkgPSAnJztcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzdHIubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDIpIHtcbiAgICAgICAgZW5jQ2hyID0gcGFyc2VJbnQoc3RyLnN1YnN0cmluZyhpLCBpICsgMiksIDE2KSBeIE1hdGguZmxvb3IoKHByYW5kIC8gbW9kdSkgKiAyNTUpO1xuICAgICAgICBlbmNTdHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShlbmNDaHIpO1xuICAgICAgICBwcmFuZCA9IChtdWx0ICogcHJhbmQgKyBpbmNyKSAlIG1vZHU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGVuY1N0cik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyB2YWxpZGF0ZUF1dGgoZW5jcnlwdENvZGU6IHN0cmluZykge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5kb1ZhbGlkYXRlQXV0aChlbmNyeXB0Q29kZSk7XG4gICAgfSwgMCk7XG4gIH1cbiAgc3RhdGljIGRvVmFsaWRhdGVBdXRoKGVuY3J5cHRDb2RlOiBzdHJpbmcpIHtcbiAgICB0aGlzLmVuY3J5cHRDb2RlID0gZW5jcnlwdENvZGU7XG4gICAgdmFyIGVuQ29kZVN0ciA9IHRoaXMuZGVjcnlwdCh0aGlzLmVuY3J5cHRDb2RlKTtcbiAgICB2YXIgaG9zdHMgPSBlbkNvZGVTdHIuc3BsaXQoJ3wnKVswXTsgLy/mlK/mjIHlpJrkuKppcOWQjOaXtuaOiOadg++8jOS7pemAl+WPt+malOW8gFxuICAgIHZhciBkZWFkbGluZSA9IGVuQ29kZVN0ci5zcGxpdCgnfCcpWzFdO1xuICAgIHRoaXMuYXV0aHR5cGUgPSBlbkNvZGVTdHIuc3BsaXQoJ3wnKVsyXTtcblxuICAgIC8vIGxvY2FsaG9zdFxuICAgIGxldCBob3N0bmFtZSA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZS50b1VwcGVyQ2FzZSgpO1xuICAgIGlmIChob3N0bmFtZSA9PT0gXCJMT0NBTEhPU1RcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBiSG9zdFBhc3MgPSBmYWxzZTtcbiAgICB2YXIgaG9zdEFycnkgPSBob3N0cy5zcGxpdCgnLCcpO1xuICAgIGhvc3RBcnJ5LmZvckVhY2goaG9zdCA9PiB7XG4gICAgICBpZiAoaG9zdC50b1VwcGVyQ2FzZSgpID09PSBob3N0bmFtZSkge1xuICAgICAgICBiSG9zdFBhc3MgPSB0cnVlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWJIb3N0UGFzcykge1xuICAgICAgdGhpcy5zaG93QXV0aERsZyhcIui9r+S7tuacquaOiOadg++8jOivt+iBlOezu+i9r+S7tuaPkOS+m+WVhu+8jOiOt+WPluaOiOadg+egge+8gVwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvL+aYr+WQpui/h+acn1xuICAgIGlmICh0eXBlb2YgKGRlYWRsaW5lKSA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAvL+mHjeWumuWQkeWIsGVycumhtTtcbiAgICAgIHRoaXMuc2hvd0F1dGhEbGcoXCLova/ku7bmnKrmjojmnYPvvIzor7fogZTns7vova/ku7bmj5DkvpvllYbvvIzojrflj5bmjojmnYPnoIHvvIFcIik7XG4gICAgfVxuICAgIHZhciBvRGF0ZTEgPSB0aGlzLmdldFNlcnZlckRhdGUoKTtcbiAgICB2YXIgb0RhdGUyID0gbmV3IERhdGUoZGVhZGxpbmUpO1xuICAgIGlmIChvRGF0ZTEuZ2V0VGltZSgpID4gb0RhdGUyLmdldFRpbWUoKSkge1xuICAgICAgLy/ph43lrprlkJHliLBlcnLpobU7XG4gICAgICB0aGlzLnNob3dBdXRoRGxnKHRoaXMuYXV0aHR5cGUgKyBcIuaciemZkOacn+iHs+OAkFwiICsgZGVhZGxpbmUgKyBcIuOAkVwiICsgXCLlt7Lov4fmnJ/vvIzor7fph43mlrDmjojmnYPvvIFA5bGx57u056eR5oqAXCIpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmF1dGh0eXBlICE9IFwi5q2j5byP54mIXCIpIHtcbiAgICAgIHRoaXMuc2hvd0F1dGhJbmZvKFwi5byA5Y+R6aKE6KeI54mI77yM5pyJ6ZmQ5pyf6Iez44CQXCIgKyBkZWFkbGluZSArIFwi44CRXCIgKyBcIkDlsbHnu7Tnp5HmioBcIik7XG4gICAgfVxuXG4gIH1cblxuICBzdGF0aWMgaXNJRSgpIHsgLy9pZT9cbiAgICBpZiAoISF3aW5kb3dbXCJBY3RpdmVYT2JqZWN0XCJdIHx8IFwiQWN0aXZlWE9iamVjdFwiIGluIHdpbmRvdykge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgc3RhdGljIGdldFNlcnZlckRhdGUoKSB7XG4gICAgdmFyIHhociA9IG51bGw7XG4gICAgaWYgKHdpbmRvd1snWE1MSHR0cFJlcXVlc3QnXSkge1xuICAgICAgeGhyID0gbmV3IHdpbmRvd1snWE1MSHR0cFJlcXVlc3QnXSgpO1xuICAgIH0gZWxzZSB7IC8vIGllXG4gICAgICB4aHIgPSBuZXcgd2luZG93W1wiQWN0aXZlWE9iamVjdFwiXShcIk1pY3Jvc29mdFwiKVxuICAgIH1cbiAgICB4aHIub3BlbihcIkdFVFwiLCBcIi9cIiwgZmFsc2UpIC8vZmFsc2XkuI3lj6/lj5hcbiAgICB4aHIuc2VuZChudWxsKTtcbiAgICB2YXIgZGF0ZSA9IHhoci5nZXRSZXNwb25zZUhlYWRlcihcIkRhdGVcIik7XG4gICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpO1xuICB9XG4gIC8v5Y+z5LiL6KeS5pi+56S65byA5Y+R54mI5YaF5a65XG4gIHN0YXRpYyBzaG93QXV0aEluZm8obXNnOiBzdHJpbmcpIHtcblxuICAgIHZhciBjaE9iaiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29weXJpZ2h0aW5mb1wiKTtcbiAgICBpZiAoY2hPYmopIHtcbiAgICAgIC8v5a2Y5ZyoIFxuICAgICAgY2hPYmouaW5uZXJIVE1MID0gbXNnO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBub2RlLmlkID0gXCJjb3B5cmlnaHRpbmZvXCI7XG4gICAgICBub2RlLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgICAgbm9kZS5zdHlsZS5ib3R0b20gPSBcIjBweFwiO1xuICAgICAgbm9kZS5zdHlsZS5yaWdodCA9IFwiMjBweFwiO1xuICAgICAgbm9kZS5zdHlsZS5mb250U2l6ZSA9IFwiMTRweFwiO1xuICAgICAgbm9kZS5zdHlsZS56SW5kZXggPSBcIjcwMFwiO1xuICAgICAgbm9kZS5zdHlsZS5jb2xvciA9IFwiI2U1MWMyM1wiO1xuICAgICAgdmFyIHRleHRub2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobXNnKTtcbiAgICAgIG5vZGUuYXBwZW5kQ2hpbGQodGV4dG5vZGUpO1xuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChub2RlKTtcbiAgICB9XG4gIH1cbiAgc3RhdGljIHNob3dBdXRoRGxnKG1zZzogc3RyaW5nKSB7XG5cbiAgICB2YXIgY2hPYmogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvcHlEbGdpbmZvXCIpO1xuICAgIGlmICghY2hPYmopIHtcblxuICAgICAgLy/mj5LlhaXpga7pmpwgXG5cbiAgICAgIHZhciBvTWFzayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBvTWFzay5pZCA9IFwibWFza1wiO1xuICAgICAgb01hc2suc3R5bGUuYmFja2dyb3VuZCA9IFwiIzAwMFwiO1xuICAgICAgb01hc2suc3R5bGUub3BhY2l0eSA9IFwiMC42NVwiO1xuICAgICAgb01hc2suc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcbiAgICAgIG9NYXNrLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgICAgb01hc2suc3R5bGUubGVmdCA9IFwiMFwiO1xuICAgICAgb01hc2suc3R5bGUudG9wID0gXCIwXCI7XG4gICAgICBvTWFzay5zdHlsZS5ib3R0b20gPSBcIjBcIjtcbiAgICAgIG9NYXNrLnN0eWxlLnpJbmRleCA9IFwiMTAwMFwiO1xuXG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG9NYXNrKTtcblxuXG4gICAgICAvL+aPkuWFpeWGheWuueaYvuekulxuICAgICAgdmFyIGh0bWwgPSAnPGRpdiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyOyBtYXJnaW4tdG9wOjE1MHB4O1wiPjxwIHN0eWxlPVwiY29sb3I6cmVkXCI+JyArIG1zZyArICc8L3A+PGEgaHJlZj1cIiNcIiBpZD1cImhpZGVXaW5cIj7liLfmlrA8L2E+IDwvZGl2Pic7XG5cbiAgICAgIHZhciBub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIG5vZGUuaWQgPSBcImNvcHlEbGdpbmZvXCI7XG4gICAgICBub2RlLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgICAgbm9kZS5zdHlsZS50b3AgPSBcIjBcIjtcbiAgICAgIG5vZGUuc3R5bGUucmlnaHQgPSBcIjBcIjtcbiAgICAgIG5vZGUuc3R5bGUuYm90dG9tID0gXCIwXCI7XG4gICAgICBub2RlLnN0eWxlLmxlZnQgPSBcIjBcIjtcbiAgICAgIG5vZGUuc3R5bGUubWFyZ2luID0gXCJhdXRvXCI7XG4gICAgICBub2RlLnN0eWxlLmZvbnRTaXplID0gXCIxNHB4XCI7XG4gICAgICBub2RlLnN0eWxlLmJvcmRlclJhZGl1cyA9IFwiMjBweFwiO1xuICAgICAgbm9kZS5zdHlsZS56SW5kZXggPSBcIjEwMDFcIjtcbiAgICAgIG5vZGUuc3R5bGUud2lkdGggPSBcIjUwMHB4XCJcbiAgICAgIG5vZGUuc3R5bGUuaGVpZ2h0ID0gXCIzMDBweFwiXG4gICAgICBub2RlLnN0eWxlLmNvbG9yID0gXCIjZTUxYzIzXCI7XG4gICAgICBub2RlLnN0eWxlLmJhY2tncm91bmQgPSBcIiNmZmZcIjtcbiAgICAgIC8vIG5vZGUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgICBub2RlLmlubmVySFRNTCA9IGh0bWw7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG5vZGUpO1xuXG4gICAgICAvLyBsZXQgbm9kZVRvcCA9IC0xMDAwO1xuICAgICAgLy8gbGV0IHRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgLy8gICBpZiAobm9kZVRvcCA8IDApIHtcbiAgICAgIC8vICAgICBub2RlVG9wID0gbm9kZVRvcCArIDE7XG4gICAgICAvLyAgICAgbm9kZS5zdHlsZS50b3AgPSBub2RlVG9wICsgXCJweFwiO1xuICAgICAgLy8gICB9IGVsc2Uge1xuICAgICAgLy8gICAgIGNsZWFySW50ZXJ2YWwodGltZXIpO1xuICAgICAgLy8gICB9XG4gICAgICAvLyB9LCAxKTtcblxuXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGlkZVdpbicpLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxufVxuIl19