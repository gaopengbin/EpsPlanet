class SimpleLoaderService {
    constructor() {
    }
    static getInstance() {
        if (!this._instance) {
            this._instance = new SimpleLoaderService();
        }
        return this._instance;
    }
    is(type, obj) {
        let clas = Object.prototype.toString.call(obj).slice(8, -1);
        return obj !== undefined && obj !== null && clas === type;
    }
    isArray(item) {
        return this.is("Array", item);
    }
    getExtension(url) {
        url = url || "";
        let items = url.split("?")[0].split(".");
        return items[items.length - 1].toLowerCase();
    }
    createElement(config) {
        let e = document.createElement(config.element);
        for (let i in config) {
            if (i !== 'element' && i !== 'appendTo') {
                e[i] = config[i];
            }
        }
        let root = document.getElementsByTagName(config.appendTo)[0];
        return (typeof root.appendChild(e) === 'object');
    }
    elementLoaded(url, onLoad) {
        if (onLoad) {
            onLoad(url);
        }
    }
    elementReadyStateChanged(url, thisObj, onLoad) {
        if (thisObj.readyState === 'loaded' || thisObj.readyState === 'complete') {
            this.elementLoaded(url, onLoad);
        }
    }
    loadCss(url, onLoad) {
        let result = this.createElement({
            element: 'link',
            rel: 'stylesheet',
            type: 'text/css',
            href: url,
            onload: () => {
                this.elementLoaded(url, onLoad);
            },
            appendTo: 'head'
        });
        let ti = setInterval(() => {
            let styles = document.styleSheets;
            for (let i = 0; i < styles.length; i++) {
                if (styles[i].href &&
                    styles[i].href.substr(styles[i].href.indexOf(url), styles[i].href.length) === url) {
                    clearInterval(ti);
                    this.elementLoaded(url, onLoad);
                }
            }
        }, 500);
        return result;
    }
    loadJs(url, onLoad) {
        let result = this.createElement({
            element: 'script',
            type: 'text/javascript',
            onload: () => {
                this.elementLoaded(url, onLoad);
            },
            onreadystatechange: () => {
                this.elementReadyStateChanged(url, this, onLoad);
            },
            src: url,
            appendTo: 'body'
        });
        return result;
    }
    loadResources(ress, onOneBeginLoad, onOneLoad, onLoad) {
        let loaded = [];
        const checkHaveLoaded = (url) => {
            for (let i = 0; i < loaded.length; i++) {
                if (loaded[i] === url) {
                    return true;
                }
            }
            return false;
        };
        const _onOneLoad = (url) => {
            if (checkHaveLoaded(url)) {
                return;
            }
            loaded.push(url);
            if (onOneLoad) {
                onOneLoad(url, loaded.length);
            }
            if (loaded.length === ress.length) {
                if (onLoad) {
                    onLoad();
                }
            }
        };
        for (let i = 0; i < ress.length; i++) {
            this.loadResource(ress[i], onOneBeginLoad, _onOneLoad);
        }
    }
    loadResource(url, onBeginLoad, onLoad) {
        if (onBeginLoad) {
            onBeginLoad(url);
        }
        let type = this.getExtension(url);
        if (type.toLowerCase() === 'css') {
            this.loadCss(url, onLoad);
        }
        else {
            this.loadJs(url, onLoad);
        }
    }
}
SimpleLoaderService._instance = null;
export const simpleLoader = SimpleLoaderService.getInstance();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2ltcGxlLWxvYWRlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvZXBzZ2lzL3NlcnZpY2VzL3NpbXBsZS1sb2FkZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFHQSxNQUFNLG1CQUFtQjtJQUtyQjtJQUVBLENBQUM7SUFDRCxNQUFNLENBQUMsV0FBVztRQUNkLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ2pCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO1NBQzlDO1FBQ0QsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQzFCLENBQUM7SUFNTyxFQUFFLENBQUMsSUFBWSxFQUFFLEdBQVE7UUFDN0IsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM1RCxPQUFPLEdBQUcsS0FBSyxTQUFTLElBQUksR0FBRyxLQUFLLElBQUksSUFBSSxJQUFJLEtBQUssSUFBSSxDQUFDO0lBQzlELENBQUM7SUFLTyxPQUFPLENBQUMsSUFBUztRQUNyQixPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2xDLENBQUM7SUFNTyxZQUFZLENBQUMsR0FBVztRQUM1QixHQUFHLEdBQUcsR0FBRyxJQUFJLEVBQUUsQ0FBQztRQUNoQixJQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN6QyxPQUFPLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ2pELENBQUM7SUFLTyxh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QUFDO0lBT0QsWUFBWSxDQUFDLEdBQVcsRUFBRSxXQUFzQixFQUFFLE1BQWlCO1FBQy9ELElBQUksV0FBVyxFQUFFO1lBQ2IsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ3BCO1FBQ0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQyxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUUsS0FBSyxLQUFLLEVBQUU7WUFDOUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUMsTUFBTSxDQUFDLENBQUM7U0FDNUI7YUFBTTtZQUNILElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQzNCO0lBRUwsQ0FBQzs7QUE3TGMsNkJBQVMsR0FBd0IsSUFBSSxDQUFDO0FBZ016RCxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsbUJBQW1CLENBQUMsV0FBVyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogY3JlYXRlIGJ5IHJ1aXIgIGpzIOOAgWNzc+WKoOi9veWZqFxyXG4gKi9cclxuY2xhc3MgU2ltcGxlTG9hZGVyU2VydmljZSB7XHJcbiAgICAvKipcclxuICAgICAqIOWNleS+i1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHN0YXRpYyBfaW5zdGFuY2U6IFNpbXBsZUxvYWRlclNlcnZpY2UgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcclxuXHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0SW5zdGFuY2UoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9pbnN0YW5jZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9pbnN0YW5jZSA9IG5ldyBTaW1wbGVMb2FkZXJTZXJ2aWNlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog57G75Z6L5Yik5patXHJcbiAgICAgKiBAcGFyYW0gdHlwZSBcclxuICAgICAqIEBwYXJhbSBvYmogXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgaXModHlwZTogc3RyaW5nLCBvYmo6IGFueSkge1xyXG4gICAgICAgIGxldCBjbGFzID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikuc2xpY2UoOCwgLTEpO1xyXG4gICAgICAgIHJldHVybiBvYmogIT09IHVuZGVmaW5lZCAmJiBvYmogIT09IG51bGwgJiYgY2xhcyA9PT0gdHlwZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm5pWw57uEXHJcbiAgICAgKiBAcGFyYW0gaXRlbSBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBpc0FycmF5KGl0ZW06IGFueSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlzKFwiQXJyYXlcIiwgaXRlbSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5Z1cmzmianlsZXlkI1cclxuICAgICAqIEBwYXJhbSB1cmwgXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0RXh0ZW5zaW9uKHVybDogc3RyaW5nKSB7XHJcbiAgICAgICAgdXJsID0gdXJsIHx8IFwiXCI7XHJcbiAgICAgICAgbGV0IGl0ZW1zID0gdXJsLnNwbGl0KFwiP1wiKVswXS5zcGxpdChcIi5cIik7XHJcbiAgICAgICAgcmV0dXJuIGl0ZW1zW2l0ZW1zLmxlbmd0aCAtIDFdLnRvTG93ZXJDYXNlKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7uuWFg+e0oFxyXG4gICAgICogQHBhcmFtIGNvbmZpZyBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjcmVhdGVFbGVtZW50KGNvbmZpZzogYW55KSB7XHJcbiAgICAgICAgbGV0IGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGNvbmZpZy5lbGVtZW50KTtcclxuICAgICAgICBmb3IgKGxldCBpIGluIGNvbmZpZykge1xyXG4gICAgICAgICAgICBpZiAoaSAhPT0gJ2VsZW1lbnQnICYmIGkgIT09ICdhcHBlbmRUbycpIHtcclxuICAgICAgICAgICAgICAgIGVbaV0gPSBjb25maWdbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHJvb3QgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShjb25maWcuYXBwZW5kVG8pWzBdO1xyXG4gICAgICAgIHJldHVybiAodHlwZW9mIHJvb3QuYXBwZW5kQ2hpbGQoZSkgPT09ICdvYmplY3QnKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0gdXJsIFxyXG4gICAgICogQHBhcmFtIG9uTG9hZCBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBlbGVtZW50TG9hZGVkKHVybDogc3RyaW5nLCBvbkxvYWQ/OiBGdW5jdGlvbikge1xyXG4gICAgICAgIGlmIChvbkxvYWQpIHtcclxuICAgICAgICAgICAgb25Mb2FkKHVybCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB1cmwgXHJcbiAgICAgKiBAcGFyYW0gdGhpc09iaiBcclxuICAgICAqIEBwYXJhbSBvbkxvYWQg5Yqg6L295LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZWxlbWVudFJlYWR5U3RhdGVDaGFuZ2VkKHVybDogc3RyaW5nLCB0aGlzT2JqOiBhbnksIG9uTG9hZD86IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgaWYgKHRoaXNPYmoucmVhZHlTdGF0ZSA9PT0gJ2xvYWRlZCcgfHwgdGhpc09iai5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudExvYWRlZCh1cmwsIG9uTG9hZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDliqDovb1jc3NcclxuICAgICAqIEBwYXJhbSB1cmwgY3NzIHVybFxyXG4gICAgICogQHBhcmFtIG9uTG9hZCDliqDovb3kuovku7ZcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBsb2FkQ3NzKHVybDogc3RyaW5nLCBvbkxvYWQ/OiBGdW5jdGlvbikge1xyXG4gICAgICAgIGxldCByZXN1bHQgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoe1xyXG4gICAgICAgICAgICBlbGVtZW50OiAnbGluaycsXHJcbiAgICAgICAgICAgIHJlbDogJ3N0eWxlc2hlZXQnLFxyXG4gICAgICAgICAgICB0eXBlOiAndGV4dC9jc3MnLFxyXG4gICAgICAgICAgICBocmVmOiB1cmwsXHJcbiAgICAgICAgICAgIG9ubG9hZDogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50TG9hZGVkKHVybCwgb25Mb2FkKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYXBwZW5kVG86ICdoZWFkJ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvL+WvueS6juS4jeinpuWPkeWKoOi9veS6i+S7tueahOa1j+iniOWZqFxyXG4gICAgICAgIC8vIFNhZmFyaeWcqOWKoOi9veagt+W8j+aXtuabtOaWsGRvY3VtZW50LnN0eWxlc2hlZXRz44CCXHJcbiAgICAgICAgbGV0IHRpID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgc3R5bGVzID0gZG9jdW1lbnQuc3R5bGVTaGVldHM7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3R5bGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhzdHlsZXNbaV0uaHJlZik7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3R5bGVzW2ldLmhyZWYgJiZcclxuICAgICAgICAgICAgICAgICAgICBzdHlsZXNbaV0uaHJlZi5zdWJzdHIoc3R5bGVzW2ldLmhyZWYuaW5kZXhPZih1cmwpLCBzdHlsZXNbaV0uaHJlZi5sZW5ndGgpID09PSB1cmwpIHtcclxuICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRpKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRMb2FkZWQodXJsLCBvbkxvYWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgNTAwKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5Yqg6L29anNcclxuICAgICAqIEBwYXJhbSB1cmwganMgdXJsXHJcbiAgICAgKiBAcGFyYW0gb25Mb2FkIOWKoOi9veS6i+S7tlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGxvYWRKcyh1cmw6IHN0cmluZywgb25Mb2FkPzogRnVuY3Rpb24pIHtcclxuICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5jcmVhdGVFbGVtZW50KHtcclxuICAgICAgICAgICAgZWxlbWVudDogJ3NjcmlwdCcsXHJcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0L2phdmFzY3JpcHQnLFxyXG4gICAgICAgICAgICBvbmxvYWQ6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudExvYWRlZCh1cmwsIG9uTG9hZCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9ucmVhZHlzdGF0ZWNoYW5nZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50UmVhZHlTdGF0ZUNoYW5nZWQodXJsLCB0aGlzLCBvbkxvYWQpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzcmM6IHVybCxcclxuICAgICAgICAgICAgYXBwZW5kVG86ICdib2R5J1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yqg6L29SmF2YVNjcmlwdOOAgUNzc+i1hOa6kO+8iOWkmuS4qu+8iVxyXG4gICAgICogQHBhcmFtIHJlc3Mg6LWE5rqQ6Lev5b6E5pWw57uEXHJcbiAgICAgKiBAcGFyYW0gb25PbmVCZWdpbkxvYWQg5Y2V5Liq6LWE5rqQ5byA5aeL5Yqg6L295Zue6LCD5LqL5Lu2XHJcbiAgICAgKiBAcGFyYW0gb25PbmVMb2FkIOWNleS4qui1hOa6kOWKoOi9veWujOaIkOWbnuiwg+S6i+S7tlxyXG4gICAgICogQHBhcmFtIG9uTG9hZCDmiYDmnInotYTmupDliqDovb3lrozmiJDlm57osIPkuovku7ZcclxuICAgICAqL1xyXG4gICAgbG9hZFJlc291cmNlcyhyZXNzOiBzdHJpbmdbXSwgb25PbmVCZWdpbkxvYWQ/OiBGdW5jdGlvbiwgb25PbmVMb2FkPzogRnVuY3Rpb24sIG9uTG9hZD86IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgbGV0IGxvYWRlZCA9IFtdO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIOajgOa1i+aYr+WQpuW3sue7j+inpuWPkei/h29ubG9hZOS6i+S7tlxyXG4gICAgICAgICAqIEBwYXJhbSB1cmwgXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgY29uc3QgY2hlY2tIYXZlTG9hZGVkID0gKHVybCkgPT4ge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxvYWRlZC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxvYWRlZFtpXSA9PT0gdXJsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBvbmxvYWRcclxuICAgICAgICAgKiBAcGFyYW0gdXJsIFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGNvbnN0IF9vbk9uZUxvYWQgPSAodXJsKSA9PiB7XHJcbiAgICAgICAgICAgIC8v6YG/5YWN5aSa5qyh5Ye65Y+Rb25sb2Fk5LqL5Lu2XHJcbiAgICAgICAgICAgIGlmIChjaGVja0hhdmVMb2FkZWQodXJsKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxvYWRlZC5wdXNoKHVybCk7XHJcbiAgICAgICAgICAgIGlmIChvbk9uZUxvYWQpIHtcclxuICAgICAgICAgICAgICAgIG9uT25lTG9hZCh1cmwsIGxvYWRlZC5sZW5ndGgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChsb2FkZWQubGVuZ3RoID09PSByZXNzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9uTG9hZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9uTG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5sb2FkUmVzb3VyY2UocmVzc1tpXSwgb25PbmVCZWdpbkxvYWQsIF9vbk9uZUxvYWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWKoOi9vUphdmFTY3JpcHTjgIFDc3PotYTmupDvvIjkuIDkuKrvvIlcclxuICAgICAqIEBwYXJhbSB1cmwg6LWE5rqQ6Lev5b6EXHJcbiAgICAgKiBAcGFyYW0gb25CZWdpbkxvYWQg5byA5aeL5Yqg6L295Zue6LCD5LqL5Lu2XHJcbiAgICAgKiBAcGFyYW0gb25Mb2FkIOi1hOa6kOWKoOi9veWujOaIkOWbnuiwg+S6i+S7tlxyXG4gICAgICovXHJcbiAgICBsb2FkUmVzb3VyY2UodXJsOiBzdHJpbmcsIG9uQmVnaW5Mb2FkPzogRnVuY3Rpb24sIG9uTG9hZD86IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgaWYgKG9uQmVnaW5Mb2FkKSB7XHJcbiAgICAgICAgICAgIG9uQmVnaW5Mb2FkKHVybCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCB0eXBlID0gdGhpcy5nZXRFeHRlbnNpb24odXJsKTtcclxuICAgICAgICBpZiAodHlwZS50b0xvd2VyQ2FzZSgpID09PSAnY3NzJykge1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRDc3ModXJsLG9uTG9hZCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5sb2FkSnModXJsLG9uTG9hZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbn1cclxuZXhwb3J0IGNvbnN0IHNpbXBsZUxvYWRlciA9IFNpbXBsZUxvYWRlclNlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcclxuXHJcbi8vdGVzdFxyXG4vLyBzaW1wbGVMb2FkZXIubG9hZFJlc291cmNlKFwiYXNzZXRzL3NtbGliLzJkL2xpYnMvbW9tZW50LmpzL21vbWVudC5taW4uanNcIiwgKCkgPT4ge1xyXG4vLyAgIGNvbnNvbGUubG9nKFwic2ltcGxlTG9hZGVyLmxvYWRSZXNvdXJjZSBPbkJlZ2luTG9hZFwiKTtcclxuLy8gfSwgKCkgPT4ge1xyXG4vLyAgIGNvbnNvbGUubG9nKFwic2ltcGxlTG9hZGVyLmxvYWRSZXNvdXJjZSBPbkxvYWRcIik7XHJcbi8vICAgY29uc29sZS5sb2coYG1vbWVudC5ub3coKToke3dpbmRvd1tcIm1vbWVudFwiXS5ub3coKX1gKTtcclxuLy8gfSk7XHJcbi8qXHJcbnNpbXBsZUxvYWRlci5sb2FkUmVzb3VyY2VzKFtcclxuICAgIFwiYXNzZXRzL3NtbGliLzNkL2pzL2NoaW5hLmpzXCIsXHJcbiAgICBcImFzc2V0cy9zbWxpYi8zZC9qcy9jb25maWcuanNcIixcclxuICAgIFwiYXNzZXRzL3NtbGliLzNkL2pzL2VjaGFydHMuanNcIlxyXG5dLCAodXJsKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhgc2ltcGxlTG9hZGVyLmxvYWRSZXNvdXJjZXMgWyR7dXJsfV3lvIDlp4vliqDovb1gKTtcclxufSwgKHVybCkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coYHNpbXBsZUxvYWRlci5sb2FkUmVzb3VyY2VzIFske3VybH1d5Yqg6L295a6M5oiQYCk7XHJcbn0sICgpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGBzaW1wbGVMb2FkZXIubG9hZFJlc291cmNlcyDmiYDmnInliqDovb3lrozmiJBgKTtcclxufSk7XHJcbiovXHJcbiJdfQ==